[
    {
        "id": "791a64d775ed255a",
        "type": "tab",
        "label": "2nd Floor Lights v1",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "25b94ca4d48979df",
        "type": "tab",
        "label": "2nd Floor Lights v2",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "d142db9d1a2f6e7e",
        "type": "tab",
        "label": "2nd Floor Lights v3",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "d0aa97dc7a4bc04f",
        "type": "tab",
        "label": "2nd Floor Desk",
        "disabled": true,
        "info": "Interesting:\n- passing flow to other flow\n- checking Tasmota switch state\n- writing data to a file",
        "env": []
    },
    {
        "id": "f0ef22c0b696182f",
        "type": "tab",
        "label": "2nd Floor Desk v2",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "e4f8b2fae37c27e7",
        "type": "tab",
        "label": "Breakalert-WLED",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "a951951f3950191b",
        "type": "tab",
        "label": "Bike Charge 6h",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "497313bae368cffb",
        "type": "tab",
        "label": "Anyone home?",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "7ea9894b62d00340",
        "type": "tab",
        "label": "Playground 1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "bc52afb68bb2be89",
        "type": "tab",
        "label": "1st Floor Lights v3",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "03d0df180b773622",
        "type": "tab",
        "label": "1st Floor Lights v4",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "4769076e30583f2e",
        "type": "tab",
        "label": "Buttons",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "e86e32e3984d7a10",
        "type": "tab",
        "label": "Door",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "e1b8a77c64d29e6e",
        "type": "tab",
        "label": "Flow 3",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "78ddf6bd666829fb",
        "type": "tab",
        "label": "Ground Floor v1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "47ad76887e14580c",
        "type": "subflow",
        "name": "PIR Subflow [DEPRECATED]",
        "info": "# PIR\n\nThis subflow addresses a problem with Zigbee PIR sensors which stay inactive when they detect a constant movement.\n\n## Inputs\n\nTest input to inject PIR message for testing purpose.\n\n## Outputs\n\n### Output I\n\nMotion detected.\n\n### Output II\n\nNo motion.\n\n## Parameters\n\nPIR Topic\n",
        "category": "",
        "in": [
            {
                "x": 160,
                "y": 260,
                "wires": [
                    {
                        "id": "66bf7050b88a98eb"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1420,
                "y": 140,
                "wires": [
                    {
                        "id": "9f3cab9b7b6da2a4",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1420,
                "y": 200,
                "wires": [
                    {
                        "id": "9f3cab9b7b6da2a4",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "PIR_TOPIC",
                "type": "str",
                "value": "",
                "ui": {
                    "icon": "font-awesome/fa-server",
                    "label": {
                        "en-US": "PIR Topic"
                    }
                }
            }
        ],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "c36763b8799fc77d",
        "type": "subflow",
        "name": "set light payload",
        "info": "# Set Light Payload\n\nThis subflow check if it is a night time or day time and sets corresponding light settigs.\n\n## Input\nAnything\n\n## Outputs\n\nPayload for light (Ikea bulbs): \n- Output I: night \n- Output II: day",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 120,
                "wires": [
                    {
                        "id": "d0b2570a590f3591"
                    },
                    {
                        "id": "cbdeaeed63a07c65"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1206,
                "y": 109,
                "wires": [
                    {
                        "id": "4791c481ae59dd95",
                        "port": 0
                    },
                    {
                        "id": "994ef1a0d6652825",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "NIGHT_BRIGHTNESS",
                "type": "num",
                "value": "100",
                "ui": {
                    "icon": "font-awesome/fa-lightbulb-o",
                    "label": {
                        "en-US": "Bulb Night Brightness"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str",
                            "num",
                            "json",
                            "env"
                        ]
                    }
                }
            },
            {
                "name": "NIGHT_TIME",
                "type": "str",
                "value": "21:00",
                "ui": {
                    "icon": "font-awesome/fa-clock-o",
                    "label": {
                        "en-US": "Night Time"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str",
                            "env"
                        ]
                    }
                }
            },
            {
                "name": "DAY_TIME",
                "type": "str",
                "value": "06:00",
                "ui": {
                    "icon": "font-awesome/fa-clock-o",
                    "label": {
                        "en-US": "Day Time"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str",
                            "env"
                        ]
                    }
                }
            },
            {
                "name": "DARKNESS_THRESHOLD",
                "type": "num",
                "value": "200",
                "ui": {
                    "icon": "font-awesome/fa-low-vision",
                    "label": {
                        "en-US": "Darkness Threshold [LUX]"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str",
                            "num",
                            "json",
                            "env"
                        ]
                    }
                }
            }
        ],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "ce92b488da80a9bb",
        "type": "subflow",
        "name": "light switch",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 120,
                "wires": [
                    {
                        "id": "29c36933d9c5dc45"
                    },
                    {
                        "id": "e718ffafdca16d06"
                    },
                    {
                        "id": "162989156222fc83"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1580,
                "y": 80,
                "wires": [
                    {
                        "id": "bd7e9ef0e3061caa",
                        "port": 0
                    },
                    {
                        "id": "f1ebfec39651a32e",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1580,
                "y": 220,
                "wires": [
                    {
                        "id": "f1ebfec39651a32e",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "TIMEOUT",
                "type": "num",
                "value": "10",
                "ui": {
                    "icon": "font-awesome/fa-hourglass-half",
                    "label": {
                        "en-US": "Timeout"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "num"
                        ]
                    }
                }
            },
            {
                "name": "NIGHT_TIMEOUT",
                "type": "num",
                "value": "5",
                "ui": {
                    "icon": "font-awesome/fa-hourglass-half",
                    "label": {
                        "en-US": "Night Timeout"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "num"
                        ]
                    }
                }
            },
            {
                "name": "NIGHT_TIME",
                "type": "str",
                "value": "21:00",
                "ui": {
                    "icon": "font-awesome/fa-clock-o",
                    "label": {
                        "en-US": "Night Time"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str"
                        ]
                    }
                }
            },
            {
                "name": "DAY_TIME",
                "type": "str",
                "value": "06:00",
                "ui": {
                    "icon": "font-awesome/fa-clock-o",
                    "label": {
                        "en-US": "Day Time"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str"
                        ]
                    }
                }
            },
            {
                "name": "DARKNESS_THRESHOLD",
                "type": "num",
                "value": "199",
                "ui": {
                    "icon": "font-awesome/fa-low-vision",
                    "label": {
                        "en-US": "Darkness Threshold [LUX]"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "num"
                        ]
                    }
                }
            },
            {
                "name": "NIGHT_BRIGHTNESS",
                "type": "num",
                "value": "150",
                "ui": {
                    "icon": "font-awesome/fa-lightbulb-o",
                    "label": {
                        "en-US": "Night Brightness"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "num"
                        ]
                    }
                }
            }
        ],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "0230ded9ff0f120f",
        "type": "subflow",
        "name": "Subflow 1",
        "info": "",
        "in": [],
        "out": []
    },
    {
        "id": "cb7cf013bfa17c66",
        "type": "subflow",
        "name": "set light payload v2",
        "info": "# Set Light Payload\n\nThis subflow check if it is a night time or day time and sets corresponding light settigs.\n\n## Input\nAnything\n\n## Outputs\n\nPayload for light (Ikea bulbs): \n- Output I: night \n- Output II: day\n\n{\n   \"state\": \"ON\",\n   \"brightness\": $env('NIGHT_BRIGHTNESS'),\n   \"color_temp\": 340\n}\n\n```json\n$ ~> |$|{\"state\": $env('NIGHT_BRIGHTNESS') > 0 ? \"ON\" : \"OFF\", \"brightness\": $env('NIGHT_BRIGHTNESS')}|\n```\n\n```json\n{\n   \"state\": \"ON\",\n   \"brightness\": $env('NIGHT_BRIGHTNESS'),\n   \"color_temp\": 340\n}\n```",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 120,
                "wires": [
                    {
                        "id": "54b284972a2d56a9"
                    },
                    {
                        "id": "83088b10c4187bf3"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1206,
                "y": 109,
                "wires": [
                    {
                        "id": "e360c8e62748dd4a",
                        "port": 0
                    },
                    {
                        "id": "fa0d289c7b8f427a",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "NIGHT_BRIGHTNESS",
                "type": "num",
                "value": "100",
                "ui": {
                    "icon": "font-awesome/fa-lightbulb-o",
                    "label": {
                        "en-US": "Bulb Night Brightness"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str",
                            "num",
                            "json",
                            "env"
                        ]
                    }
                }
            },
            {
                "name": "NIGHT_TIME",
                "type": "str",
                "value": "21:00",
                "ui": {
                    "icon": "font-awesome/fa-clock-o",
                    "label": {
                        "en-US": "Night Time"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str",
                            "env"
                        ]
                    }
                }
            },
            {
                "name": "DAY_TIME",
                "type": "str",
                "value": "06:00",
                "ui": {
                    "icon": "font-awesome/fa-clock-o",
                    "label": {
                        "en-US": "Day Time"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str",
                            "env"
                        ]
                    }
                }
            },
            {
                "name": "DARKNESS_THRESHOLD",
                "type": "num",
                "value": "200",
                "ui": {
                    "icon": "font-awesome/fa-low-vision",
                    "label": {
                        "en-US": "Darkness Threshold [LUX]"
                    },
                    "type": "input",
                    "opts": {
                        "types": [
                            "str",
                            "num",
                            "json",
                            "env"
                        ]
                    }
                }
            }
        ],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "64b9e597ca308567",
        "type": "group",
        "z": "4769076e30583f2e",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "1f6185e980a0d76e",
            "8a638e9042079b6f",
            "761752eb212b75d2"
        ],
        "x": 914,
        "y": 19
    },
    {
        "id": "c8bf62168f8a7f4a",
        "type": "junction",
        "z": "e4f8b2fae37c27e7",
        "x": 380,
        "y": 380,
        "wires": [
            [
                "080e1a673d34b6b7"
            ]
        ]
    },
    {
        "id": "66bf7050b88a98eb",
        "type": "junction",
        "z": "47ad76887e14580c",
        "x": 240,
        "y": 260,
        "wires": [
            [
                "b4d4e77d1a06c893",
                "2bd91bd73a58c120"
            ]
        ]
    },
    {
        "id": "bfc8df5c1a440313",
        "type": "junction",
        "z": "e86e32e3984d7a10",
        "x": 540,
        "y": 400,
        "wires": [
            [
                "f7fb07ccdf63870e",
                "f495bf6e00b170e7",
                "b6ae998389b4ec71"
            ]
        ]
    },
    {
        "id": "3ea2a9db3d9d7fd8",
        "type": "mqtt-broker",
        "name": "mqtt",
        "broker": "192.168.1.142",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "sessionExpiry": ""
    },
    {
        "id": "aa146f4d.b53ca",
        "type": "ui_tab",
        "name": "Home",
        "icon": "home",
        "order": 1,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "a30599dce7613846",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "reset": false
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "true",
            "lockMenu": "icon",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "3ca99660d7292448",
        "type": "ui_tab",
        "name": "Timer",
        "icon": "timer",
        "order": 3,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "33977842a9fcae11",
        "type": "ui_group",
        "name": "Timed Charger",
        "tab": "3ca99660d7292448",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "3b825d13cf529239",
        "type": "ui_group",
        "name": "Light Timers",
        "tab": "bd20fd29a3ae5c51",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "bd20fd29a3ae5c51",
        "type": "ui_tab",
        "name": "Lights",
        "icon": "wb_incandescent",
        "order": 2,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "3b7c9cd86fb22b9a",
        "type": "ui_group",
        "name": "Front Door",
        "tab": "aa146f4d.b53ca",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "2bd91bd73a58c120",
        "type": "switch",
        "z": "47ad76887e14580c",
        "name": "occupancy",
        "property": "payload.occupancy",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 390,
        "y": 260,
        "wires": [
            [
                "88144dfaa01a6acb"
            ],
            []
        ]
    },
    {
        "id": "b4d4e77d1a06c893",
        "type": "function",
        "z": "47ad76887e14580c",
        "name": "Flow Config",
        "func": "const occupancy = msg.payload.occupancy;\nconst countdown = 10;\n\nflow.set(\"PIR_SUBFLOW\", {\n    \"occupancy\": occupancy,\n    \"countdown\": countdown,\n    \"lastOutput\" : null\n});",
        "outputs": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 160,
        "wires": []
    },
    {
        "id": "0827d6d0fd640808",
        "type": "countdown",
        "z": "47ad76887e14580c",
        "name": "",
        "topic": "",
        "payloadTimerStart": "true",
        "payloadTimerStartType": "bool",
        "payloadTimerStop": "false",
        "payloadTimerStopType": "bool",
        "timer": "10",
        "resetWhileRunning": true,
        "outputOnReset": true,
        "setTimeToNewWhileRunning": true,
        "startCountdownOnControlMessage": true,
        "x": 930,
        "y": 260,
        "wires": [
            [
                "069b9d922c477251"
            ],
            []
        ]
    },
    {
        "id": "069b9d922c477251",
        "type": "function",
        "z": "47ad76887e14580c",
        "name": "Keep ON when occupancy is true",
        "func": "// node.warn(`Message[${JSON.stringify(msg)}]`);\nconst LIGHT_ON = true;\nconst LIGHT_OFF = false;\n\nfunction outputOne(msg) {\n    node.warn(`Output 1[${JSON.stringify(msg)}]`)\n    return [msg, null];\n}\nfunction outputTwo(msg) {\n    node.warn(`Output 2[${JSON.stringify(msg)}]`)\n    return [null, msg];\n}\nconst occupancy = flow.get(\"PIR_SUBFLOW\").occupancy;\nconst countDownValue = flow.get(\"PIR_SUBFLOW\").countdown;\nlet lastOutput = flow.get(\"PIR_SUBFLOW\").lastOutput;\n\nconst isCountingOn = msg.payload;\nconst payloadInfoMsg = isCountingOn ? `Incoming payload[TRUE] light on` : `Incoming payload[FALSE] light off`;\nnode.warn(payloadInfoMsg);\n\n // Timer has stopped but occupancy still true\nif (!isCountingOn && occupancy) {\n    node.warn(`Timer has stopped but occupancy still ${occupancy}`);\n    // topic === 'control' restarts Timer\n    msg.topic = 'control';\n    msg.payload = countDownValue;\n    return outputTwo(msg);\n}\n\nlet currentOutput = isCountingOn ? LIGHT_ON : LIGHT_OFF;\nconst logMsg = `Last output[${lastOutput}] current[${currentOutput}]`;\nif (currentOutput !== lastOutput) {\n    node.warn(logMsg + \" send\");\n    flow.set(\"PIR_SUBFLOW\", {\n        \"occupancy\": occupancy,\n        \"countdown\": countDownValue,\n        \"lastOutput\": currentOutput\n    });\n    return outputOne(msg);\n}\nnode.warn(logMsg + \" don't send\");\nreturn [null,null];\n\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 180,
        "wires": [
            [
                "9f3cab9b7b6da2a4",
                "84dee3ff53d4f9e9"
            ],
            [
                "0827d6d0fd640808",
                "3e875f166cd02d9b"
            ]
        ]
    },
    {
        "id": "88144dfaa01a6acb",
        "type": "change",
        "z": "47ad76887e14580c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$flowContext('PIR_SUBFLOW').countdown",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "control",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 260,
        "wires": [
            [
                "0827d6d0fd640808"
            ]
        ]
    },
    {
        "id": "715eca580d24d722",
        "type": "debug",
        "z": "47ad76887e14580c",
        "d": true,
        "name": "PIR 1st Floor",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 490,
        "y": 80,
        "wires": []
    },
    {
        "id": "6addff1c97d71ad8",
        "type": "mqtt in",
        "z": "47ad76887e14580c",
        "name": "",
        "topic": "${PIR_TOPIC}",
        "qos": "0",
        "datatype": "json",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 160,
        "wires": [
            [
                "2bd91bd73a58c120",
                "b4d4e77d1a06c893",
                "715eca580d24d722"
            ]
        ]
    },
    {
        "id": "9f3cab9b7b6da2a4",
        "type": "switch",
        "z": "47ad76887e14580c",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1230,
        "y": 160,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "84dee3ff53d4f9e9",
        "type": "debug",
        "z": "47ad76887e14580c",
        "d": true,
        "name": "debug 54",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1400,
        "y": 60,
        "wires": []
    },
    {
        "id": "3e875f166cd02d9b",
        "type": "debug",
        "z": "47ad76887e14580c",
        "d": true,
        "name": "debug 55",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1400,
        "y": 260,
        "wires": []
    },
    {
        "id": "4791c481ae59dd95",
        "type": "change",
        "z": "c36763b8799fc77d",
        "name": "Set night light",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t   \"state\": \"ON\",\t   \"brightness\": $env('NIGHT_BRIGHTNESS'),\t   \"color_temp\": 340\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 110,
        "wires": [
            [
                "b610ca2f33780bbd"
            ]
        ]
    },
    {
        "id": "994ef1a0d6652825",
        "type": "change",
        "z": "c36763b8799fc77d",
        "name": "Set day light",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"state\":\"ON\",\"color_temp\":340,\"brightness\":254}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 983,
        "y": 207,
        "wires": [
            [
                "b610ca2f33780bbd"
            ]
        ]
    },
    {
        "id": "d0b2570a590f3591",
        "type": "time-range-switch",
        "z": "c36763b8799fc77d",
        "name": "",
        "lat": "",
        "lon": "",
        "startTime": "${NIGHT_TIME}",
        "endTime": "${DAY_TIME}",
        "startOffset": 0,
        "endOffset": 0,
        "x": 250,
        "y": 120,
        "wires": [
            [
                "4791c481ae59dd95",
                "683f1498e707758d"
            ],
            [
                "9371b33fc0bbeb82",
                "bc4358f779e015a7"
            ]
        ]
    },
    {
        "id": "b610ca2f33780bbd",
        "type": "debug",
        "z": "c36763b8799fc77d",
        "name": "debug 60",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 40,
        "wires": []
    },
    {
        "id": "82cd3448daa929e0",
        "type": "switch",
        "z": "c36763b8799fc77d",
        "name": "isDark?",
        "property": "payload.illuminance_lux",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lt",
                "v": "DARKNESS_THRESHOLD",
                "vt": "env"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 766,
        "y": 160,
        "wires": [
            [
                "994ef1a0d6652825",
                "be6a592645bf8bc5"
            ],
            [
                "bc2fa01d69f56dd2"
            ]
        ]
    },
    {
        "id": "9371b33fc0bbeb82",
        "type": "debug",
        "z": "c36763b8799fc77d",
        "name": "debug 74",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 860,
        "y": 40,
        "wires": []
    },
    {
        "id": "683f1498e707758d",
        "type": "debug",
        "z": "c36763b8799fc77d",
        "name": "debug 75",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 660,
        "y": 20,
        "wires": []
    },
    {
        "id": "be6a592645bf8bc5",
        "type": "debug",
        "z": "c36763b8799fc77d",
        "name": "sub I",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 160,
        "wires": []
    },
    {
        "id": "bc2fa01d69f56dd2",
        "type": "debug",
        "z": "c36763b8799fc77d",
        "name": "sub III",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 970,
        "y": 280,
        "wires": []
    },
    {
        "id": "bc4358f779e015a7",
        "type": "switch",
        "z": "c36763b8799fc77d",
        "name": "hasBrigthnessSensor",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "hask",
                "v": "illuminance_lux",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 548,
        "y": 199,
        "wires": [
            [
                "82cd3448daa929e0"
            ],
            [
                "994ef1a0d6652825"
            ]
        ]
    },
    {
        "id": "cbdeaeed63a07c65",
        "type": "change",
        "z": "c36763b8799fc77d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t    \"DAY_TIME\": $env(\"DAY_TIME\"),\t    \"NIGHT_TIME\": $env(\"NIGHT_TIME\"),\t    \"DARKNESS_THRESHOLD\": $env(\"DARKNESS_THRESHOLD\"),\t    \"NIGHT_BRIGHTNESS\": $env(\"NIGHT_BRIGHTNESS\")\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 180,
        "y": 220,
        "wires": [
            [
                "3d37e04bcb68eb9f"
            ]
        ]
    },
    {
        "id": "3d37e04bcb68eb9f",
        "type": "debug",
        "z": "c36763b8799fc77d",
        "name": "Input params",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 490,
        "y": 280,
        "wires": []
    },
    {
        "id": "c8e2dc6ec37015dd",
        "type": "switch",
        "z": "ce92b488da80a9bb",
        "name": "occupancy",
        "property": "payload.occupancy",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "neq",
                "v": "true",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 790,
        "y": 120,
        "wires": [
            [
                "bd7e9ef0e3061caa",
                "9c1d04136028d9bd"
            ],
            [
                "5e08cdd3f255f106"
            ]
        ]
    },
    {
        "id": "bd7e9ef0e3061caa",
        "type": "subflow:c36763b8799fc77d",
        "z": "ce92b488da80a9bb",
        "name": "",
        "env": [
            {
                "name": "NIGHT_BRIGHTNESS",
                "value": "NIGHT_BRIGHTNESS",
                "type": "env"
            },
            {
                "name": "NIGHT_TIME",
                "value": "NIGHT_TIME",
                "type": "env"
            },
            {
                "name": "DAY_TIME",
                "value": "DAY_TIME",
                "type": "env"
            },
            {
                "name": "DARKNESS_THRESHOLD",
                "value": "DARKNESS_THRESHOLD",
                "type": "env"
            },
            {
                "name": "BRIGHTNESS",
                "value": "NIGHT_BRIGHTNESS",
                "type": "env"
            },
            {
                "name": "DARKNESS",
                "value": "DARKNESS_THRESHOLD",
                "type": "env"
            }
        ],
        "x": 1240,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "f1ebfec39651a32e",
        "type": "countdown",
        "z": "ce92b488da80a9bb",
        "name": "",
        "topic": "",
        "payloadTimerStart": "",
        "payloadTimerStartType": "nul",
        "payloadTimerStop": "{\"state\":\"OFF\",\"transition\":5}",
        "payloadTimerStopType": "json",
        "timer": "${TIMEOUT}",
        "resetWhileRunning": true,
        "outputOnReset": false,
        "setTimeToNewWhileRunning": true,
        "startCountdownOnControlMessage": true,
        "x": 1230,
        "y": 200,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "9c1d04136028d9bd",
        "type": "change",
        "z": "ce92b488da80a9bb",
        "name": "stop timer",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1220,
        "y": 140,
        "wires": [
            [
                "f1ebfec39651a32e"
            ]
        ]
    },
    {
        "id": "29c36933d9c5dc45",
        "type": "debug",
        "z": "ce92b488da80a9bb",
        "name": "TIMEOUT variable",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "$env(\"TIMEOUT\")",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 490,
        "y": 280,
        "wires": []
    },
    {
        "id": "56580ded5e7d6c5c",
        "type": "comment",
        "z": "ce92b488da80a9bb",
        "name": "turns light on/off",
        "info": "",
        "x": 1700,
        "y": 80,
        "wires": []
    },
    {
        "id": "bd18ba3a398ec9ba",
        "type": "comment",
        "z": "ce92b488da80a9bb",
        "name": "countdown steps",
        "info": "",
        "x": 1700,
        "y": 220,
        "wires": []
    },
    {
        "id": "e718ffafdca16d06",
        "type": "time-range-switch",
        "z": "ce92b488da80a9bb",
        "name": "",
        "lat": "",
        "lon": "",
        "startTime": "${NIGHT_TIME}",
        "endTime": "${DAY_TIME}",
        "startOffset": 0,
        "endOffset": 0,
        "x": 310,
        "y": 120,
        "wires": [
            [
                "4f6269c04141c656"
            ],
            [
                "cb8335dd19adcba4"
            ]
        ]
    },
    {
        "id": "4f6269c04141c656",
        "type": "change",
        "z": "ce92b488da80a9bb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "timeout",
                "pt": "flow",
                "to": "${NIGHT_TIMEOUT}",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 60,
        "wires": [
            [
                "c8e2dc6ec37015dd",
                "72def6605746bc55"
            ]
        ]
    },
    {
        "id": "cb8335dd19adcba4",
        "type": "change",
        "z": "ce92b488da80a9bb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "timeout",
                "pt": "flow",
                "to": "${TIMEOUT}",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 180,
        "wires": [
            [
                "c8e2dc6ec37015dd",
                "72def6605746bc55"
            ]
        ]
    },
    {
        "id": "5e08cdd3f255f106",
        "type": "change",
        "z": "ce92b488da80a9bb",
        "name": "Set countdown",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$flowContext('timeout')",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "control",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1000,
        "y": 180,
        "wires": [
            [
                "f1ebfec39651a32e",
                "f33a8c42af95cbe2"
            ]
        ]
    },
    {
        "id": "72def6605746bc55",
        "type": "debug",
        "z": "ce92b488da80a9bb",
        "name": "debug 90",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 880,
        "y": 300,
        "wires": []
    },
    {
        "id": "f33a8c42af95cbe2",
        "type": "debug",
        "z": "ce92b488da80a9bb",
        "name": "debug 91",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1220,
        "y": 320,
        "wires": []
    },
    {
        "id": "162989156222fc83",
        "type": "debug",
        "z": "ce92b488da80a9bb",
        "name": "NIGHT_TIMEOUT variable",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "$env(\"NIGHT_TIMEOUT\")",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 510,
        "y": 340,
        "wires": []
    },
    {
        "id": "e360c8e62748dd4a",
        "type": "change",
        "z": "cb7cf013bfa17c66",
        "name": "Set night light",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t   \"state\": $env('NIGHT_BRIGHTNESS') > 0 ? \"ON\" : \"OFF\",\t   \"brightness\": $env('NIGHT_BRIGHTNESS'),\t   \"color_temp\": 340\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 110,
        "wires": [
            [
                "b88939eb1478ef68"
            ]
        ]
    },
    {
        "id": "fa0d289c7b8f427a",
        "type": "change",
        "z": "cb7cf013bfa17c66",
        "name": "Set day light",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"state\":\"ON\",\"color_temp\":340,\"brightness\":254}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 983,
        "y": 207,
        "wires": [
            [
                "b88939eb1478ef68"
            ]
        ]
    },
    {
        "id": "54b284972a2d56a9",
        "type": "time-range-switch",
        "z": "cb7cf013bfa17c66",
        "name": "",
        "lat": "",
        "lon": "",
        "startTime": "${NIGHT_TIME}",
        "endTime": "${DAY_TIME}",
        "startOffset": 0,
        "endOffset": 0,
        "x": 250,
        "y": 120,
        "wires": [
            [
                "e360c8e62748dd4a",
                "7a27bf6ddf5cb728"
            ],
            [
                "dbf74ca8148e0a3c",
                "73e5040742c24e8e"
            ]
        ]
    },
    {
        "id": "b88939eb1478ef68",
        "type": "debug",
        "z": "cb7cf013bfa17c66",
        "name": "debug 60",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 40,
        "wires": []
    },
    {
        "id": "530e5584d9bced3f",
        "type": "switch",
        "z": "cb7cf013bfa17c66",
        "name": "isDark?",
        "property": "payload.illuminance_lux",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lt",
                "v": "DARKNESS_THRESHOLD",
                "vt": "env"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 766,
        "y": 160,
        "wires": [
            [
                "fa0d289c7b8f427a",
                "49162b87cc2c9e27"
            ],
            [
                "04710b3e733964be"
            ]
        ]
    },
    {
        "id": "dbf74ca8148e0a3c",
        "type": "debug",
        "z": "cb7cf013bfa17c66",
        "name": "debug 74",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 860,
        "y": 40,
        "wires": []
    },
    {
        "id": "7a27bf6ddf5cb728",
        "type": "debug",
        "z": "cb7cf013bfa17c66",
        "name": "debug 75",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 660,
        "y": 20,
        "wires": []
    },
    {
        "id": "49162b87cc2c9e27",
        "type": "debug",
        "z": "cb7cf013bfa17c66",
        "name": "sub I",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 160,
        "wires": []
    },
    {
        "id": "04710b3e733964be",
        "type": "debug",
        "z": "cb7cf013bfa17c66",
        "name": "sub III",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 970,
        "y": 280,
        "wires": []
    },
    {
        "id": "73e5040742c24e8e",
        "type": "switch",
        "z": "cb7cf013bfa17c66",
        "name": "hasBrigthnessSensor",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "hask",
                "v": "illuminance_lux",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 548,
        "y": 199,
        "wires": [
            [
                "530e5584d9bced3f"
            ],
            [
                "fa0d289c7b8f427a"
            ]
        ]
    },
    {
        "id": "83088b10c4187bf3",
        "type": "change",
        "z": "cb7cf013bfa17c66",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t    \"DAY_TIME\": $env(\"DAY_TIME\"),\t    \"NIGHT_TIME\": $env(\"NIGHT_TIME\"),\t    \"DARKNESS_THRESHOLD\": $env(\"DARKNESS_THRESHOLD\"),\t    \"NIGHT_BRIGHTNESS\": $env(\"NIGHT_BRIGHTNESS\")\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 180,
        "y": 220,
        "wires": [
            [
                "1b5424f5b1192867"
            ]
        ]
    },
    {
        "id": "1b5424f5b1192867",
        "type": "debug",
        "z": "cb7cf013bfa17c66",
        "name": "Input params",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 490,
        "y": 280,
        "wires": []
    },
    {
        "id": "938267a9823b26e3",
        "type": "mqtt out",
        "z": "791a64d775ed255a",
        "name": "",
        "topic": "zigbee2mqtt/Bulb_Ikea_02/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1810,
        "y": 40,
        "wires": []
    },
    {
        "id": "02e629d182f8c4c3",
        "type": "mqtt in",
        "z": "791a64d775ed255a",
        "name": "",
        "topic": "zigbee2mqtt/PIR_SNZB-03_01",
        "qos": "0",
        "datatype": "json",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 170,
        "y": 60,
        "wires": [
            [
                "362d038ac827b883",
                "fbbc812021940c21"
            ]
        ]
    },
    {
        "id": "362d038ac827b883",
        "type": "switch",
        "z": "791a64d775ed255a",
        "name": "occupancy",
        "property": "payload.occupancy",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "neq",
                "v": "true",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 410,
        "y": 140,
        "wires": [
            [
                "0f4d403b420271dd",
                "82de959111b099ef",
                "31e225d3f6522173"
            ],
            []
        ]
    },
    {
        "id": "fbbc812021940c21",
        "type": "function",
        "z": "791a64d775ed255a",
        "name": "Flow Config",
        "func": "const occupancy = msg.payload.occupancy;\nnode.warn(`Setting PIR_SNZB-03_01 occupancy [${JSON.stringify(msg.payload.occupancy)}]`);\n\nflow.set(\"PIR_SNZB-03_01\", {\n    \"occupancy\": occupancy\n});\n// flow.set(\"Countdown\", {\n//     \"value\": 133\n// });\n\nflow.set(\"Bulb_Ikea_02\", {\n    \"countdown\": 120,\n    \"light\": {\n        \"state\": \"ON\",\n        \"brightness\": 254,\n        \"color_temp\": \"neutral\"\n    }\n});",
        "outputs": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 60,
        "wires": []
    },
    {
        "id": "0f4d403b420271dd",
        "type": "time-range-switch",
        "z": "791a64d775ed255a",
        "name": "",
        "lat": "",
        "lon": "",
        "startTime": "21:00",
        "endTime": "06:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 610,
        "y": 140,
        "wires": [
            [
                "f6fe1bb053e90c67",
                "530e4dddfb1dfc63"
            ],
            [
                "4b5576650b77081f",
                "7a055e96d3a1923c"
            ]
        ]
    },
    {
        "id": "87ebd91d3f470331",
        "type": "countdown",
        "z": "791a64d775ed255a",
        "name": "",
        "topic": "",
        "payloadTimerStart": "true",
        "payloadTimerStartType": "bool",
        "payloadTimerStop": "false",
        "payloadTimerStopType": "bool",
        "timer": "10",
        "resetWhileRunning": true,
        "outputOnReset": true,
        "setTimeToNewWhileRunning": true,
        "startCountdownOnControlMessage": true,
        "x": 1330,
        "y": 140,
        "wires": [
            [
                "cb2a56f60a077606"
            ],
            [
                "cb6ff9ada54dbd35"
            ]
        ]
    },
    {
        "id": "f6fe1bb053e90c67",
        "type": "change",
        "z": "791a64d775ed255a",
        "name": "Set night light",
        "rules": [
            {
                "t": "set",
                "p": "Bulb_Ikea_02.light",
                "pt": "flow",
                "to": "{\"state\":\"ON\",\"brightness\":150,\"color_temp\":\"neutral\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 100,
        "wires": [
            [
                "7a055e96d3a1923c"
            ]
        ]
    },
    {
        "id": "cb2a56f60a077606",
        "type": "function",
        "z": "791a64d775ed255a",
        "name": "Keep ON when occupancy is true",
        "func": "node.warn(`Message[${JSON.stringify(msg)}]`);\n\nfunction outputOne(msg) {\n    node.warn(`Output 1`)\n    return [msg, null];\n}\nfunction outputTwo(msg) {\n    node.warn(`Output 2[${JSON.stringify(msg)}]`)\n    return [null, msg];\n}\nconst occupancy = flow.get(\"PIR_SNZB-03_01\").occupancy;\nconst countDownValue = flow.get(\"Bulb_Ikea_02\").countdown;\nconst lightOnPayload = flow.get(\"Bulb_Ikea_02\").light;\nconst lightOffPayload = {\n    state: \"OFF\"\n}\n// node.warn(`Light On: ${JSON.stringify(lightOnPayload)}`);\n\nconst coundownStarted = msg.payload;\n\nif (coundownStarted) {\n    node.warn(`Payload[TRUE] - timer started - light on`);\n} else {\n    node.warn(`Payload[FALSE] - timer stoppped - light off`);\n}\n // Stop timer - light off\nif (!coundownStarted && occupancy) {\n    node.warn(`Lights off but occupancy[${occupancy}]`);\n    // topic === 'control' restarts Timer\n    msg.topic = 'control';\n    msg.payload = countDownValue;\n    return outputTwo(msg);\n}\nmsg.payload = coundownStarted ? lightOnPayload : lightOffPayload;\nreturn outputOne(msg);\n\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1400,
        "y": 60,
        "wires": [
            [
                "938267a9823b26e3"
            ],
            [
                "87ebd91d3f470331"
            ]
        ]
    },
    {
        "id": "cb6ff9ada54dbd35",
        "type": "ui_gauge",
        "z": "791a64d775ed255a",
        "name": "",
        "group": "3b825d13cf529239",
        "order": 4,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "II Floor ",
        "label": "Seconds",
        "format": "{{value}}",
        "min": 0,
        "max": "300",
        "colors": [
            "#fff700",
            "#fff700",
            "#fff700"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1530,
        "y": 200,
        "wires": []
    },
    {
        "id": "7a055e96d3a1923c",
        "type": "change",
        "z": "791a64d775ed255a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$flowContext('Bulb_Ikea_02').countdown",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "control",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1100,
        "y": 147,
        "wires": [
            [
                "87ebd91d3f470331",
                "7734a53de8f8f515",
                "6ddb100fc9cede6f"
            ]
        ]
    },
    {
        "id": "0703df022074d667",
        "type": "mqtt in",
        "z": "791a64d775ed255a",
        "name": "",
        "topic": "zigbee2mqtt/PIR_Aqara_01",
        "qos": "0",
        "datatype": "json",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 140,
        "y": 580,
        "wires": [
            [
                "bd241d8822a5f23a",
                "35bd3fc41fca7126"
            ]
        ]
    },
    {
        "id": "bd241d8822a5f23a",
        "type": "function",
        "z": "791a64d775ed255a",
        "name": "Flow Config",
        "func": "const lux = msg.payload.illuminance_lux;\n//flow.set(\"isDark\", lux < 200 ? 1 : 0); //mytodo remove\n\nconst occupancy = msg.payload.occupancy;\nflow.set(\"PIR_Aqara_01\", {\n    \"occupancy\": occupancy,\n    \"isDark\": lux < 200\n});\n// flow.set(\"Countdown\", {\n//     \"value\": 133\n// });\n\nflow.set(\"RELAY_BASICZBR3\", {\n    \"countdown\": 600\n});",
        "outputs": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 520,
        "wires": []
    },
    {
        "id": "35bd3fc41fca7126",
        "type": "switch",
        "z": "791a64d775ed255a",
        "name": "occupancy",
        "property": "payload.occupancy",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "neq",
                "v": "true",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 410,
        "y": 580,
        "wires": [
            [
                "3d9c1f860675bcc2",
                "29b307a140e84a49",
                "82de959111b099ef",
                "31e225d3f6522173"
            ],
            [
                "29b307a140e84a49"
            ]
        ]
    },
    {
        "id": "3d9c1f860675bcc2",
        "type": "time-range-switch",
        "z": "791a64d775ed255a",
        "name": "",
        "lat": "",
        "lon": "",
        "startTime": "21:00",
        "endTime": "06:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 650,
        "y": 540,
        "wires": [
            [
                "f6fe1bb053e90c67",
                "530e4dddfb1dfc63"
            ],
            [
                "c61e33382e9c8d84",
                "4b5576650b77081f"
            ]
        ]
    },
    {
        "id": "c61e33382e9c8d84",
        "type": "switch",
        "z": "791a64d775ed255a",
        "name": "flow.isDark?",
        "property": "PIR_Aqara_01.isDark",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 910,
        "y": 540,
        "wires": [
            [
                "35e91d728aa98399"
            ],
            []
        ]
    },
    {
        "id": "3aaead6100c3835d",
        "type": "countdown",
        "z": "791a64d775ed255a",
        "name": "",
        "topic": "",
        "payloadTimerStart": "true",
        "payloadTimerStartType": "bool",
        "payloadTimerStop": "false",
        "payloadTimerStopType": "bool",
        "timer": "10",
        "resetWhileRunning": true,
        "outputOnReset": true,
        "setTimeToNewWhileRunning": true,
        "startCountdownOnControlMessage": true,
        "x": 1510,
        "y": 520,
        "wires": [
            [
                "a505ae904f09578b"
            ],
            [
                "c72714565c399a6d"
            ]
        ]
    },
    {
        "id": "a505ae904f09578b",
        "type": "function",
        "z": "791a64d775ed255a",
        "name": "Keep Ceiling ON when occupancy is true",
        "func": "node.warn(`Message[${JSON.stringify(msg)}]`);\n\nfunction outputOne(msg) {\n    node.warn(`Output 1`)\n    return [msg, null];\n}\nfunction outputTwo(msg) {\n    node.warn(`Output 2[${JSON.stringify(msg)}]`)\n    return [null, msg];\n}\nconst occupancy = flow.get(\"PIR_Aqara_01\").occupancy;\nconst countDownValue = flow.get(\"RELAY_BASICZBR3\").countdown;\n\nconst lightOnPayload = {\n    state: \"ON\"\n};\nconst lightOffPayload = {\n    state: \"OFF\"\n};\n// node.warn(`Light On: ${JSON.stringify(lightOnPayload)}`);\n\nconst coundownStarted = msg.payload;\n\nif (coundownStarted) {\n    node.warn(`Payload[TRUE] - timer started - light on`);\n} else {\n    node.warn(`Payload[FALSE] - timer stopped - light off`);\n}\n // Stop timer - light off\nif (!coundownStarted && occupancy) {\n    node.warn(`Lights off but occupancy[${occupancy}]`);\n    // topic === 'control' restarts Timer\n    msg.topic = 'control';\n    msg.payload = countDownValue;\n    return outputTwo(msg);\n}\nmsg.payload = coundownStarted ? lightOnPayload : lightOffPayload;\nreturn outputOne(msg);\n\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1600,
        "y": 440,
        "wires": [
            [
                "0501d9fe26dbaaf7"
            ],
            [
                "3aaead6100c3835d"
            ]
        ]
    },
    {
        "id": "c72714565c399a6d",
        "type": "ui_gauge",
        "z": "791a64d775ed255a",
        "name": "",
        "group": "3b825d13cf529239",
        "order": 6,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "II Floor Ceiling",
        "label": "Seconds",
        "format": "{{value}}",
        "min": 0,
        "max": "300",
        "colors": [
            "#fff700",
            "#fff700",
            "#fff700"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1740,
        "y": 560,
        "wires": []
    },
    {
        "id": "35e91d728aa98399",
        "type": "change",
        "z": "791a64d775ed255a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$flowContext('RELAY_BASICZBR3').countdown",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "control",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1180,
        "y": 520,
        "wires": [
            [
                "3aaead6100c3835d"
            ]
        ]
    },
    {
        "id": "0501d9fe26dbaaf7",
        "type": "mqtt out",
        "z": "791a64d775ed255a",
        "name": "Kids Room Ceiling Light",
        "topic": "zigbee2mqtt/RELAY_BASICZBR3/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1990,
        "y": 420,
        "wires": []
    },
    {
        "id": "375b150df45ec509",
        "type": "ui_text",
        "z": "791a64d775ed255a",
        "group": "3b825d13cf529239",
        "order": 12,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Kids room is",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 1130,
        "y": 720,
        "wires": []
    },
    {
        "id": "9fbb79cc18a58ed4",
        "type": "change",
        "z": "791a64d775ed255a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Dark",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 700,
        "wires": [
            [
                "375b150df45ec509"
            ]
        ]
    },
    {
        "id": "848168a394dc965e",
        "type": "change",
        "z": "791a64d775ed255a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Bright",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 740,
        "wires": [
            [
                "375b150df45ec509"
            ]
        ]
    },
    {
        "id": "29b307a140e84a49",
        "type": "switch",
        "z": "791a64d775ed255a",
        "name": "flow.isDark?",
        "property": "PIR_Aqara_01.isDark",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 650,
        "y": 720,
        "wires": [
            [
                "9fbb79cc18a58ed4"
            ],
            [
                "848168a394dc965e"
            ]
        ]
    },
    {
        "id": "7cf903c5fc29e470",
        "type": "ui_text",
        "z": "791a64d775ed255a",
        "group": "3b825d13cf529239",
        "order": 11,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Light mode",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 1210,
        "y": 320,
        "wires": []
    },
    {
        "id": "530e4dddfb1dfc63",
        "type": "change",
        "z": "791a64d775ed255a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Night",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 300,
        "wires": [
            [
                "7cf903c5fc29e470"
            ]
        ]
    },
    {
        "id": "4b5576650b77081f",
        "type": "change",
        "z": "791a64d775ed255a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Day",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 340,
        "wires": [
            [
                "7cf903c5fc29e470"
            ]
        ]
    },
    {
        "id": "7734a53de8f8f515",
        "type": "debug",
        "z": "791a64d775ed255a",
        "name": "debug: read flow variable",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "$flowContext('Bulb_Ikea_02')",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 1430,
        "y": 280,
        "wires": []
    },
    {
        "id": "82de959111b099ef",
        "type": "link out",
        "z": "791a64d775ed255a",
        "name": "Desk Light Flow Out",
        "mode": "link",
        "links": [
            "4d624a9f70e21a4a",
            "508a9cdce2168218"
        ],
        "x": 620,
        "y": 340,
        "wires": [],
        "l": true
    },
    {
        "id": "6ddb100fc9cede6f",
        "type": "debug",
        "z": "791a64d775ed255a",
        "name": "debug 40",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1720,
        "y": 240,
        "wires": []
    },
    {
        "id": "31e225d3f6522173",
        "type": "debug",
        "z": "791a64d775ed255a",
        "name": "debug 42",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 280,
        "wires": []
    },
    {
        "id": "7d05f45acf1a52bd",
        "type": "ui_gauge",
        "z": "25b94ca4d48979df",
        "name": "",
        "group": "3b825d13cf529239",
        "order": 5,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "{{msg.topic}}",
        "label": "Seconds",
        "format": "{{value}}",
        "min": 0,
        "max": "300",
        "colors": [
            "#fff700",
            "#fff700",
            "#fff700"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1570,
        "y": 500,
        "wires": []
    },
    {
        "id": "719d070591347b32",
        "type": "ui_gauge",
        "z": "25b94ca4d48979df",
        "name": "",
        "group": "3b825d13cf529239",
        "order": 9,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "II Floor Ceiling",
        "label": "Seconds",
        "format": "{{value}}",
        "min": 0,
        "max": "300",
        "colors": [
            "#fff700",
            "#fff700",
            "#fff700"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 2106,
        "y": 132,
        "wires": []
    },
    {
        "id": "cce85be822c269c2",
        "type": "mqtt in",
        "z": "25b94ca4d48979df",
        "name": "2nd floor stairs PIR ",
        "topic": "zigbee2mqtt/PIR_SNZB-03_01",
        "qos": "0",
        "datatype": "json",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 210,
        "y": 420,
        "wires": [
            [
                "ace4239e4e51b416"
            ]
        ]
    },
    {
        "id": "577e73421e62ddce",
        "type": "mqtt out",
        "z": "25b94ca4d48979df",
        "name": "2nd floor stairs bulb",
        "topic": "zigbee2mqtt/Bulb_Ikea_02/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1040,
        "y": 380,
        "wires": []
    },
    {
        "id": "e5ae3c24f12c1762",
        "type": "debug",
        "z": "25b94ca4d48979df",
        "name": "debug 70",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1140,
        "y": 320,
        "wires": []
    },
    {
        "id": "f53062de96305b4b",
        "type": "debug",
        "z": "25b94ca4d48979df",
        "name": "debug 71",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1140,
        "y": 440,
        "wires": []
    },
    {
        "id": "0a4e7cc160059570",
        "type": "change",
        "z": "25b94ca4d48979df",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "II Floor Light is OFF",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1320,
        "y": 480,
        "wires": [
            [
                "7d05f45acf1a52bd"
            ]
        ]
    },
    {
        "id": "9aa15cc6c7319f90",
        "type": "change",
        "z": "25b94ca4d48979df",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "II Floor Light is ON",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1320,
        "y": 540,
        "wires": [
            [
                "7d05f45acf1a52bd"
            ]
        ]
    },
    {
        "id": "0162c5f4db2607ef",
        "type": "delay",
        "z": "25b94ca4d48979df",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1140,
        "y": 480,
        "wires": [
            [
                "0a4e7cc160059570"
            ]
        ]
    },
    {
        "id": "afefc467ba67dd08",
        "type": "change",
        "z": "25b94ca4d48979df",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "II Floor Light is ON",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1340,
        "y": 400,
        "wires": [
            [
                "7d05f45acf1a52bd"
            ]
        ]
    },
    {
        "id": "47b8c93539593bd6",
        "type": "inject",
        "z": "25b94ca4d48979df",
        "name": "occupancy true",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":true,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 180,
        "y": 500,
        "wires": [
            [
                "ace4239e4e51b416"
            ]
        ]
    },
    {
        "id": "0a47222e7ebd0f86",
        "type": "inject",
        "z": "25b94ca4d48979df",
        "name": "occupancy false",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":false,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 180,
        "y": 560,
        "wires": [
            [
                "ace4239e4e51b416"
            ]
        ]
    },
    {
        "id": "1404dab74b691b8a",
        "type": "mqtt in",
        "z": "25b94ca4d48979df",
        "name": "kid's room PIR/brightness sensor",
        "topic": "zigbee2mqtt/PIR_Aqara_01",
        "qos": "0",
        "datatype": "json",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 189,
        "y": 88,
        "wires": [
            [
                "2927c95c29294797",
                "993aca605e4fe60b"
            ]
        ]
    },
    {
        "id": "55c59f99a8773535",
        "type": "mqtt out",
        "z": "25b94ca4d48979df",
        "name": "Kids Room Ceiling Light",
        "topic": "zigbee2mqtt/RELAY_BASICZBR3/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1716,
        "y": 32,
        "wires": []
    },
    {
        "id": "fe1ccb125a928d3e",
        "type": "switch",
        "z": "25b94ca4d48979df",
        "name": "occupancy",
        "property": "payload.occupancy",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "neq",
                "v": "true",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 945,
        "y": 87,
        "wires": [
            [
                "d3cd1752eca03170",
                "09013432c187eac3"
            ],
            [
                "54f2461176da3d7e"
            ]
        ]
    },
    {
        "id": "d3cd1752eca03170",
        "type": "subflow:c36763b8799fc77d",
        "z": "25b94ca4d48979df",
        "name": "",
        "env": [
            {
                "name": "NIGHT_BRIGHTNESS",
                "value": "0",
                "type": "num"
            },
            {
                "name": "NIGHT_TIME",
                "value": "23:00",
                "type": "str"
            }
        ],
        "x": 1226,
        "y": 72,
        "wires": [
            [
                "55c59f99a8773535",
                "500677099d187a12"
            ]
        ]
    },
    {
        "id": "54f2461176da3d7e",
        "type": "countdown",
        "z": "25b94ca4d48979df",
        "name": "",
        "topic": "",
        "payloadTimerStart": "",
        "payloadTimerStartType": "nul",
        "payloadTimerStop": "{\"state\":\"OFF\",\"transition\":10}",
        "payloadTimerStopType": "json",
        "timer": "1200",
        "resetWhileRunning": true,
        "outputOnReset": false,
        "setTimeToNewWhileRunning": true,
        "startCountdownOnControlMessage": true,
        "x": 1216,
        "y": 192,
        "wires": [
            [
                "55c59f99a8773535",
                "cdbf26bfc2a2d193"
            ],
            [
                "61337caa12dd38e1"
            ]
        ]
    },
    {
        "id": "09013432c187eac3",
        "type": "change",
        "z": "25b94ca4d48979df",
        "name": "stop timer",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1206,
        "y": 132,
        "wires": [
            [
                "54f2461176da3d7e"
            ]
        ]
    },
    {
        "id": "6198c17a9d879cf7",
        "type": "change",
        "z": "25b94ca4d48979df",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "II Floor Light is OFF",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1826,
        "y": 132,
        "wires": [
            [
                "719d070591347b32"
            ]
        ]
    },
    {
        "id": "61337caa12dd38e1",
        "type": "change",
        "z": "25b94ca4d48979df",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "II Floor Light is ON",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1826,
        "y": 192,
        "wires": [
            [
                "719d070591347b32"
            ]
        ]
    },
    {
        "id": "500677099d187a12",
        "type": "change",
        "z": "25b94ca4d48979df",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "II Floor Light is ON",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1826,
        "y": 92,
        "wires": [
            [
                "719d070591347b32"
            ]
        ]
    },
    {
        "id": "cdbf26bfc2a2d193",
        "type": "delay",
        "z": "25b94ca4d48979df",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1626,
        "y": 132,
        "wires": [
            [
                "6198c17a9d879cf7"
            ]
        ]
    },
    {
        "id": "ace4239e4e51b416",
        "type": "switch",
        "z": "25b94ca4d48979df",
        "name": "occupancy",
        "property": "payload.occupancy",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "neq",
                "v": "true",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 510,
        "y": 420,
        "wires": [
            [
                "50b240b6a65c3d93",
                "9547df48ccff86aa"
            ],
            [
                "9e98b3d828bf2f50"
            ]
        ]
    },
    {
        "id": "50b240b6a65c3d93",
        "type": "subflow:c36763b8799fc77d",
        "z": "25b94ca4d48979df",
        "name": "",
        "env": [
            {
                "name": "NIGHT_TIME",
                "value": "22:00",
                "type": "str"
            }
        ],
        "x": 740,
        "y": 400,
        "wires": [
            [
                "577e73421e62ddce",
                "e5ae3c24f12c1762",
                "afefc467ba67dd08"
            ]
        ]
    },
    {
        "id": "9e98b3d828bf2f50",
        "type": "countdown",
        "z": "25b94ca4d48979df",
        "name": "",
        "topic": "",
        "payloadTimerStart": "",
        "payloadTimerStartType": "nul",
        "payloadTimerStop": "{\"state\":\"OFF\",\"transition\":10}",
        "payloadTimerStopType": "json",
        "timer": "120",
        "resetWhileRunning": true,
        "outputOnReset": false,
        "setTimeToNewWhileRunning": true,
        "startCountdownOnControlMessage": true,
        "x": 730,
        "y": 520,
        "wires": [
            [
                "577e73421e62ddce",
                "0162c5f4db2607ef",
                "f53062de96305b4b"
            ],
            [
                "9aa15cc6c7319f90"
            ]
        ]
    },
    {
        "id": "9547df48ccff86aa",
        "type": "change",
        "z": "25b94ca4d48979df",
        "name": "stop timer",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 720,
        "y": 460,
        "wires": [
            [
                "9e98b3d828bf2f50"
            ]
        ]
    },
    {
        "id": "557ef22b672da7b4",
        "type": "time-range-switch",
        "z": "25b94ca4d48979df",
        "name": "",
        "lat": "",
        "lon": "",
        "startTime": "22:00",
        "endTime": "06:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 690,
        "y": 80,
        "wires": [
            [
                "5ef1bd377b5c37a6"
            ],
            [
                "fe1ccb125a928d3e",
                "277bf83f6eff0ccc"
            ]
        ]
    },
    {
        "id": "2927c95c29294797",
        "type": "switch",
        "z": "25b94ca4d48979df",
        "name": "is PIR enabled",
        "property": "disable_PIR_Aqara_01",
        "propertyType": "global",
        "rules": [
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 480,
        "y": 80,
        "wires": [
            [
                "557ef22b672da7b4",
                "8a96e50c38c3ed83"
            ]
        ]
    },
    {
        "id": "993aca605e4fe60b",
        "type": "debug",
        "z": "25b94ca4d48979df",
        "name": "debug 86",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 380,
        "y": 160,
        "wires": []
    },
    {
        "id": "8a96e50c38c3ed83",
        "type": "debug",
        "z": "25b94ca4d48979df",
        "name": "debug 87",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 640,
        "y": 180,
        "wires": []
    },
    {
        "id": "277bf83f6eff0ccc",
        "type": "debug",
        "z": "25b94ca4d48979df",
        "name": "debug 88",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 200,
        "wires": []
    },
    {
        "id": "5ef1bd377b5c37a6",
        "type": "debug",
        "z": "25b94ca4d48979df",
        "name": "debug 89",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 880,
        "y": 20,
        "wires": []
    },
    {
        "id": "0a1046cdd264a4cb",
        "type": "ui_gauge",
        "z": "d142db9d1a2f6e7e",
        "name": "",
        "group": "3b825d13cf529239",
        "order": 5,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "{{msg.topic}}",
        "label": "Seconds",
        "format": "{{value}}",
        "min": 0,
        "max": "300",
        "colors": [
            "#fff700",
            "#fff700",
            "#fff700"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1390,
        "y": 460,
        "wires": []
    },
    {
        "id": "ccebe619c5ba5b48",
        "type": "ui_gauge",
        "z": "d142db9d1a2f6e7e",
        "name": "",
        "group": "3b825d13cf529239",
        "order": 9,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "II Floor Ceiling",
        "label": "Seconds",
        "format": "{{value}}",
        "min": 0,
        "max": "300",
        "colors": [
            "#fff700",
            "#fff700",
            "#fff700"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1664,
        "y": 167,
        "wires": []
    },
    {
        "id": "eb8f23e61a597207",
        "type": "mqtt in",
        "z": "d142db9d1a2f6e7e",
        "name": "2nd floor stairs PIR ",
        "topic": "zigbee2mqtt/PIR_SNZB-03_01",
        "qos": "0",
        "datatype": "json",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 390,
        "y": 400,
        "wires": [
            [
                "0acfea2a03f174eb"
            ]
        ]
    },
    {
        "id": "728d9d16c0204722",
        "type": "mqtt out",
        "z": "d142db9d1a2f6e7e",
        "name": "2nd floor stairs bulb",
        "topic": "zigbee2mqtt/Bulb_Ikea_02/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 980,
        "y": 360,
        "wires": []
    },
    {
        "id": "6e433c2183cf22c1",
        "type": "change",
        "z": "d142db9d1a2f6e7e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "II Floor Light is OFF",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1140,
        "y": 460,
        "wires": [
            [
                "0a1046cdd264a4cb"
            ]
        ]
    },
    {
        "id": "cab4e75ec3207b0f",
        "type": "change",
        "z": "d142db9d1a2f6e7e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "II Floor Light is ON",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1040,
        "y": 540,
        "wires": [
            [
                "0a1046cdd264a4cb"
            ]
        ]
    },
    {
        "id": "cc7e0df726e5652c",
        "type": "change",
        "z": "d142db9d1a2f6e7e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "II Floor Light is ON",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1140,
        "y": 420,
        "wires": [
            [
                "0a1046cdd264a4cb"
            ]
        ]
    },
    {
        "id": "a05acec326ebe1ed",
        "type": "inject",
        "z": "d142db9d1a2f6e7e",
        "name": "occupancy true",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":true,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 360,
        "y": 480,
        "wires": [
            [
                "0acfea2a03f174eb"
            ]
        ]
    },
    {
        "id": "31435834aada415c",
        "type": "inject",
        "z": "d142db9d1a2f6e7e",
        "name": "occupancy false",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":false,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 360,
        "y": 540,
        "wires": [
            [
                "0acfea2a03f174eb"
            ]
        ]
    },
    {
        "id": "030a8281a7fad7cd",
        "type": "mqtt in",
        "z": "d142db9d1a2f6e7e",
        "name": "kid's room PIR/brightness sensor",
        "topic": "zigbee2mqtt/PIR_Aqara_01",
        "qos": "0",
        "datatype": "json",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 189,
        "y": 127,
        "wires": [
            [
                "78aa3ea68af623ae",
                "ebc98cf72fd8d834"
            ]
        ]
    },
    {
        "id": "415752f42559ba53",
        "type": "mqtt out",
        "z": "d142db9d1a2f6e7e",
        "name": "Kids Room Ceiling Light",
        "topic": "zigbee2mqtt/RELAY_BASICZBR3/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1194,
        "y": 67,
        "wires": []
    },
    {
        "id": "7a03f3b48c171137",
        "type": "subflow:ce92b488da80a9bb",
        "z": "d142db9d1a2f6e7e",
        "name": "",
        "env": [
            {
                "name": "TIMEOUT",
                "value": "1200",
                "type": "num"
            },
            {
                "name": "NIGHT_TIME",
                "value": "23:00",
                "type": "str"
            }
        ],
        "x": 914,
        "y": 134,
        "wires": [
            [
                "415752f42559ba53",
                "ce24a6888cbd628b"
            ],
            [
                "f6c7aeeb8f5b6bc7"
            ]
        ]
    },
    {
        "id": "86d16dd1e4ca1177",
        "type": "change",
        "z": "d142db9d1a2f6e7e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "II Floor Light is ON",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "300",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1364,
        "y": 107,
        "wires": [
            [
                "ccebe619c5ba5b48"
            ]
        ]
    },
    {
        "id": "f6c7aeeb8f5b6bc7",
        "type": "change",
        "z": "d142db9d1a2f6e7e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "II Floor Light is ON",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1360,
        "y": 220,
        "wires": [
            [
                "ccebe619c5ba5b48"
            ]
        ]
    },
    {
        "id": "ce24a6888cbd628b",
        "type": "switch",
        "z": "d142db9d1a2f6e7e",
        "name": "",
        "property": "payload.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ON",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1154,
        "y": 127,
        "wires": [
            [
                "86d16dd1e4ca1177"
            ],
            [
                "8b354b73892fd133"
            ]
        ]
    },
    {
        "id": "8b354b73892fd133",
        "type": "change",
        "z": "d142db9d1a2f6e7e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "II Floor Light is OFF",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1364,
        "y": 167,
        "wires": [
            [
                "ccebe619c5ba5b48"
            ]
        ]
    },
    {
        "id": "0acfea2a03f174eb",
        "type": "subflow:ce92b488da80a9bb",
        "z": "d142db9d1a2f6e7e",
        "name": "",
        "env": [
            {
                "name": "TIMEOUT",
                "value": "120",
                "type": "num"
            },
            {
                "name": "NIGHT_TIME",
                "value": "20:30",
                "type": "str"
            }
        ],
        "x": 670,
        "y": 400,
        "wires": [
            [
                "728d9d16c0204722",
                "a041fafb4183944b"
            ],
            [
                "cab4e75ec3207b0f"
            ]
        ]
    },
    {
        "id": "a041fafb4183944b",
        "type": "switch",
        "z": "d142db9d1a2f6e7e",
        "name": "",
        "property": "payload.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ON",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 916,
        "y": 439,
        "wires": [
            [
                "cc7e0df726e5652c"
            ],
            [
                "6e433c2183cf22c1"
            ]
        ]
    },
    {
        "id": "78aa3ea68af623ae",
        "type": "switch",
        "z": "d142db9d1a2f6e7e",
        "name": "is PIR enabled",
        "property": "disable_PIR_Aqara_01",
        "propertyType": "global",
        "rules": [
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 460,
        "y": 127,
        "wires": [
            [
                "46f6114eef969624"
            ]
        ]
    },
    {
        "id": "46f6114eef969624",
        "type": "time-range-switch",
        "z": "d142db9d1a2f6e7e",
        "name": "",
        "lat": "",
        "lon": "",
        "startTime": "21:00",
        "endTime": "06:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 657,
        "y": 127,
        "wires": [
            [],
            [
                "7a03f3b48c171137"
            ]
        ]
    },
    {
        "id": "ebc98cf72fd8d834",
        "type": "time-range-switch",
        "z": "d142db9d1a2f6e7e",
        "name": "",
        "lat": "",
        "lon": "",
        "startTime": "23:00",
        "endTime": "06:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 450,
        "y": 220,
        "wires": [
            [
                "0acfea2a03f174eb"
            ],
            []
        ]
    },
    {
        "id": "5eeaeadc149423bc",
        "type": "mqtt in",
        "z": "d0aa97dc7a4bc04f",
        "name": "",
        "topic": "stat/sonoff_smartswitch01/POWER",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 220,
        "y": 200,
        "wires": [
            [
                "a5fd26798ff9c12b",
                "899ef4885df9228d",
                "a93e969861efdfd7"
            ]
        ]
    },
    {
        "id": "a5fd26798ff9c12b",
        "type": "function",
        "z": "d0aa97dc7a4bc04f",
        "name": "Set Power Status",
        "func": "const flowVar = 'sonoff_smartswitch01';\nnode.warn(msg.payload);\nlet countdown = 1200;\n// if it is Wednesday (korepetycje )make timeout 1h\nconst dayOfWeek = new Date().getDay();\nconst currentHour = new Date().getHours();\nif (dayOfWeek == 3 // Wednesday \n    && currentHour > 15 \n    && currentHour < 18) {\n    countdown = 3600;\n}\nconst flowVariableObject = {\n    \"countdown\": countdown,\n    \"power\" : false\n};\nif (msg.payload === 'ON') {\n    flowVariableObject.power = true;    \n} else if (msg.payload === 'OFF') {\n    flowVariableObject.power = false;\n} else {\n    node.error('Wrong payload [' + msg.payload + ']');\n}\n\nflow.set(flowVar, flowVariableObject);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 300,
        "wires": [
            [
                "93f268e7434eb664"
            ]
        ]
    },
    {
        "id": "899ef4885df9228d",
        "type": "switch",
        "z": "d0aa97dc7a4bc04f",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ON",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 450,
        "y": 200,
        "wires": [
            [
                "cdedb8407df6a1a2",
                "5c9878eabd4c310b"
            ]
        ]
    },
    {
        "id": "63b67a8acad68805",
        "type": "countdown",
        "z": "d0aa97dc7a4bc04f",
        "name": "",
        "topic": "",
        "payloadTimerStart": "true",
        "payloadTimerStartType": "bool",
        "payloadTimerStop": "false",
        "payloadTimerStopType": "bool",
        "timer": "10",
        "resetWhileRunning": true,
        "outputOnReset": true,
        "setTimeToNewWhileRunning": true,
        "startCountdownOnControlMessage": true,
        "x": 930,
        "y": 200,
        "wires": [
            [
                "3d1394898519cf83",
                "fe4cec219c5a9651"
            ],
            [
                "10a54fb60419bd40"
            ]
        ]
    },
    {
        "id": "cdedb8407df6a1a2",
        "type": "change",
        "z": "d0aa97dc7a4bc04f",
        "name": "Set countdown",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$flowContext('sonoff_smartswitch01').countdown",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "control",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 200,
        "wires": [
            [
                "63b67a8acad68805",
                "b574ab319e779ad5"
            ]
        ]
    },
    {
        "id": "f6c58177cb2de852",
        "type": "switch",
        "z": "d0aa97dc7a4bc04f",
        "name": "is Power On",
        "property": "$flowContext('sonoff_smartswitch01').power",
        "propertyType": "jsonata",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 470,
        "y": 120,
        "wires": [
            [
                "cdedb8407df6a1a2",
                "c486e291b586863d"
            ]
        ]
    },
    {
        "id": "10a54fb60419bd40",
        "type": "ui_gauge",
        "z": "d0aa97dc7a4bc04f",
        "name": "",
        "group": "3b825d13cf529239",
        "order": 7,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Kid's Desk",
        "label": "Seconds",
        "format": "{{value}}",
        "min": 0,
        "max": "600",
        "colors": [
            "#fff700",
            "#fff700",
            "#fff700"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1190,
        "y": 240,
        "wires": []
    },
    {
        "id": "601af3158afde027",
        "type": "change",
        "z": "d0aa97dc7a4bc04f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "OFF",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1380,
        "y": 180,
        "wires": [
            [
                "f54a405a03b79072",
                "7a187efca8926dd0"
            ]
        ]
    },
    {
        "id": "f54a405a03b79072",
        "type": "mqtt out",
        "z": "d0aa97dc7a4bc04f",
        "name": "",
        "topic": "cmnd/sonoff_smartswitch01/POWER",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1690,
        "y": 180,
        "wires": []
    },
    {
        "id": "3d1394898519cf83",
        "type": "switch",
        "z": "d0aa97dc7a4bc04f",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1170,
        "y": 180,
        "wires": [
            [
                "601af3158afde027",
                "a013859d0e59166e"
            ]
        ]
    },
    {
        "id": "93f268e7434eb664",
        "type": "debug",
        "z": "d0aa97dc7a4bc04f",
        "d": true,
        "name": "debug read flow var: sonoff_smartswitch01",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "$flowContext('sonoff_smartswitch01')",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 830,
        "y": 400,
        "wires": []
    },
    {
        "id": "4d624a9f70e21a4a",
        "type": "link in",
        "z": "d0aa97dc7a4bc04f",
        "name": "Desk Light Flow In",
        "links": [
            "82de959111b099ef",
            "fba211589bc25de1"
        ],
        "x": 250,
        "y": 120,
        "wires": [
            [
                "f6c58177cb2de852"
            ]
        ],
        "l": true
    },
    {
        "id": "5c9878eabd4c310b",
        "type": "debug",
        "z": "d0aa97dc7a4bc04f",
        "d": true,
        "name": "debug 35",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 680,
        "y": 260,
        "wires": []
    },
    {
        "id": "fe4cec219c5a9651",
        "type": "debug",
        "z": "d0aa97dc7a4bc04f",
        "d": true,
        "name": "debug 36",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1180,
        "y": 120,
        "wires": []
    },
    {
        "id": "a013859d0e59166e",
        "type": "debug",
        "z": "d0aa97dc7a4bc04f",
        "d": true,
        "name": "debug 37",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1380,
        "y": 120,
        "wires": []
    },
    {
        "id": "7a187efca8926dd0",
        "type": "debug",
        "z": "d0aa97dc7a4bc04f",
        "d": true,
        "name": "debug 38",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1660,
        "y": 120,
        "wires": []
    },
    {
        "id": "c486e291b586863d",
        "type": "debug",
        "z": "d0aa97dc7a4bc04f",
        "d": true,
        "name": "debug 41",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 60,
        "wires": []
    },
    {
        "id": "b574ab319e779ad5",
        "type": "debug",
        "z": "d0aa97dc7a4bc04f",
        "d": true,
        "name": "debug 43",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 920,
        "y": 280,
        "wires": []
    },
    {
        "id": "ac516658d7f335b0",
        "type": "file",
        "z": "d0aa97dc7a4bc04f",
        "d": true,
        "name": "",
        "filename": "/share/smartswitch.log",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 700,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "a93e969861efdfd7",
        "type": "function",
        "z": "d0aa97dc7a4bc04f",
        "d": true,
        "name": "Add timestamp to payload",
        "func": "const datetime = new Date().toLocaleString();\nmsg.payload = `[${datetime}] ${msg.payload}`;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 440,
        "wires": [
            [
                "ac516658d7f335b0"
            ]
        ]
    },
    {
        "id": "0159e193b35dc93d",
        "type": "ui_gauge",
        "z": "f0ef22c0b696182f",
        "name": "",
        "group": "3b825d13cf529239",
        "order": 8,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Kid's Desk",
        "label": "Seconds",
        "format": "{{value}}",
        "min": 0,
        "max": "600",
        "colors": [
            "#fff700",
            "#fff700",
            "#fff700"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1070,
        "y": 180,
        "wires": []
    },
    {
        "id": "a70a94eea0c32b72",
        "type": "mqtt out",
        "z": "f0ef22c0b696182f",
        "name": "",
        "topic": "cmnd/sonoff_smartswitch01/POWER",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1150,
        "y": 80,
        "wires": []
    },
    {
        "id": "36e2b454d502d8ad",
        "type": "mqtt in",
        "z": "f0ef22c0b696182f",
        "name": "Science Room PIR ",
        "topic": "zigbee2mqtt/PIR_SNZB-03_03",
        "qos": "0",
        "datatype": "json",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 120,
        "wires": [
            [
                "d74caf78c62e4f1e"
            ]
        ]
    },
    {
        "id": "acbf0513271a4fcb",
        "type": "inject",
        "z": "f0ef22c0b696182f",
        "name": "occupancy true",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":true,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 120,
        "y": 200,
        "wires": [
            [
                "d74caf78c62e4f1e"
            ]
        ]
    },
    {
        "id": "92418752d374904a",
        "type": "inject",
        "z": "f0ef22c0b696182f",
        "name": "occupancy false",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":false,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 120,
        "y": 280,
        "wires": [
            [
                "d74caf78c62e4f1e"
            ]
        ]
    },
    {
        "id": "13a1c2d145877346",
        "type": "change",
        "z": "f0ef22c0b696182f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Desk Light is ON",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "600",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 820,
        "y": 160,
        "wires": [
            [
                "0159e193b35dc93d"
            ]
        ]
    },
    {
        "id": "d74caf78c62e4f1e",
        "type": "subflow:ce92b488da80a9bb",
        "z": "f0ef22c0b696182f",
        "name": "",
        "env": [
            {
                "name": "TIMEOUT",
                "value": "600",
                "type": "num"
            }
        ],
        "x": 370,
        "y": 120,
        "wires": [
            [
                "a8a8f90daa726fa3"
            ],
            [
                "f4cccd67f51cf31e"
            ]
        ]
    },
    {
        "id": "f4cccd67f51cf31e",
        "type": "change",
        "z": "f0ef22c0b696182f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Desk Light is ON",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 820,
        "y": 280,
        "wires": [
            [
                "0159e193b35dc93d"
            ]
        ]
    },
    {
        "id": "a8a8f90daa726fa3",
        "type": "switch",
        "z": "f0ef22c0b696182f",
        "name": "is on?",
        "property": "payload.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ON",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 570,
        "y": 100,
        "wires": [
            [
                "13a1c2d145877346",
                "b4b59afdbce5f625"
            ],
            [
                "50b9d1fe3be7a120",
                "d07eaecb2220e5e9"
            ]
        ]
    },
    {
        "id": "50b9d1fe3be7a120",
        "type": "change",
        "z": "f0ef22c0b696182f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Desk Light is OFF",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 820,
        "y": 220,
        "wires": [
            [
                "0159e193b35dc93d"
            ]
        ]
    },
    {
        "id": "b4b59afdbce5f625",
        "type": "change",
        "z": "f0ef22c0b696182f",
        "name": "ON",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "ON",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 790,
        "y": 60,
        "wires": [
            [
                "a70a94eea0c32b72"
            ]
        ]
    },
    {
        "id": "d07eaecb2220e5e9",
        "type": "change",
        "z": "f0ef22c0b696182f",
        "name": "OFF",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "OFF",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 790,
        "y": 100,
        "wires": [
            [
                "a70a94eea0c32b72"
            ]
        ]
    },
    {
        "id": "67b5cb9f6bbf5d07",
        "type": "mqtt in",
        "z": "e4f8b2fae37c27e7",
        "d": true,
        "name": "breakreminder",
        "topic": "sensors/breakalert/state",
        "qos": "2",
        "datatype": "utf8",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 170,
        "y": 180,
        "wires": [
            [
                "116e9277f4632943",
                "c8bf62168f8a7f4a",
                "a7b07ecd705c3f6c"
            ]
        ]
    },
    {
        "id": "8c78622369b5fd88",
        "type": "inject",
        "z": "e4f8b2fae37c27e7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "WorkState",
        "payloadType": "str",
        "x": 160,
        "y": 300,
        "wires": [
            [
                "c8bf62168f8a7f4a",
                "a7b07ecd705c3f6c"
            ]
        ]
    },
    {
        "id": "a7b07ecd705c3f6c",
        "type": "switch",
        "z": "e4f8b2fae37c27e7",
        "d": true,
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "WorkState",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "IdleState",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "RestState",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "AlertState",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 450,
        "y": 240,
        "wires": [
            [
                "ebc7c4fdbae32e13"
            ],
            [
                "aa87281b1e3f1678"
            ],
            [
                "a6405aa981d042ba"
            ],
            [
                "debe916bc49ff3c7"
            ]
        ]
    },
    {
        "id": "47173a99ced855ba",
        "type": "inject",
        "z": "e4f8b2fae37c27e7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "IdleState",
        "payloadType": "str",
        "x": 160,
        "y": 360,
        "wires": [
            [
                "c8bf62168f8a7f4a",
                "a7b07ecd705c3f6c"
            ]
        ]
    },
    {
        "id": "8229da39a06d6558",
        "type": "inject",
        "z": "e4f8b2fae37c27e7",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "RestState",
        "payloadType": "str",
        "x": 160,
        "y": 420,
        "wires": [
            [
                "c8bf62168f8a7f4a",
                "a7b07ecd705c3f6c"
            ]
        ]
    },
    {
        "id": "ebc7c4fdbae32e13",
        "type": "change",
        "z": "e4f8b2fae37c27e7",
        "name": "WLED OFF",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"on\":false}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 200,
        "wires": [
            [
                "dac0b97259befddd",
                "6c92865f3176c2fd"
            ]
        ]
    },
    {
        "id": "a6405aa981d042ba",
        "type": "change",
        "z": "e4f8b2fae37c27e7",
        "name": "WLED Rest",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"on\":true,\"ps\":4}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 260,
        "wires": [
            [
                "dac0b97259befddd",
                "6c92865f3176c2fd"
            ]
        ]
    },
    {
        "id": "aa87281b1e3f1678",
        "type": "change",
        "z": "e4f8b2fae37c27e7",
        "name": "WLED Idle",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"on\":false}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 320,
        "wires": [
            [
                "dac0b97259befddd",
                "6c92865f3176c2fd"
            ]
        ]
    },
    {
        "id": "dac0b97259befddd",
        "type": "mqtt out",
        "z": "e4f8b2fae37c27e7",
        "name": "WLED MQTT API",
        "topic": "wled/1m/api",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1170,
        "y": 420,
        "wires": []
    },
    {
        "id": "9c771518a6333fdb",
        "type": "inject",
        "z": "e4f8b2fae37c27e7",
        "name": "AlertState",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "AlertState",
        "payloadType": "str",
        "x": 160,
        "y": 480,
        "wires": [
            [
                "c8bf62168f8a7f4a",
                "a7b07ecd705c3f6c"
            ]
        ]
    },
    {
        "id": "debe916bc49ff3c7",
        "type": "change",
        "z": "e4f8b2fae37c27e7",
        "name": "WLED Alert",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"on\":true,\"ps\":5}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 380,
        "wires": [
            [
                "dac0b97259befddd",
                "6c92865f3176c2fd"
            ]
        ]
    },
    {
        "id": "b44cb91c6fa29652",
        "type": "http request",
        "z": "e4f8b2fae37c27e7",
        "d": true,
        "name": "WLED Request",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://192.168.1.42/json/state",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 1440,
        "y": 280,
        "wires": [
            [
                "830eac17bf400746"
            ]
        ]
    },
    {
        "id": "116e9277f4632943",
        "type": "debug",
        "z": "e4f8b2fae37c27e7",
        "name": "breakreminder debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 520,
        "y": 80,
        "wires": []
    },
    {
        "id": "6c92865f3176c2fd",
        "type": "debug",
        "z": "e4f8b2fae37c27e7",
        "name": "Message to wled mqtt",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1160,
        "y": 140,
        "wires": []
    },
    {
        "id": "080e1a673d34b6b7",
        "type": "function",
        "z": "e4f8b2fae37c27e7",
        "name": "LightController",
        "func": "node.warn(msg);\n\nconst dict = new Map();\ndict.set(\"IdleState\", { on: true, ps: 3 });\ndict.set(\"WorkState\", { on: false });\ndict.set(\"OvertimeState\", { on: true, ps: 9 });\ndict.set(\"AlertState\", { on: true, ps: 5 });\ndict.set(\"RestState\", { on: true, ps: 4 });\ndict.set(\"Unknown\", { on: false });\n\nconst state = msg.payload;\nif (dict.has(state)) {\n  node.warn(`Return[${JSON.stringify(dict.get(state))}]`)\n  msg.payload = dict.get(state);\n} else {\n    dict.error(\"Unknown state.\", msg);\n    node.warn(`Return[${JSON.stringify(dict.get('Unknown'))}]`)\n    msg.payload = dict.get(\"Unknown\");\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 620,
        "wires": [
            [
                "7d713dcac80b08fc",
                "dac0b97259befddd"
            ]
        ]
    },
    {
        "id": "7d713dcac80b08fc",
        "type": "debug",
        "z": "e4f8b2fae37c27e7",
        "name": "Fun output",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 700,
        "wires": []
    },
    {
        "id": "830eac17bf400746",
        "type": "debug",
        "z": "e4f8b2fae37c27e7",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1750,
        "y": 280,
        "wires": []
    },
    {
        "id": "8a74838287dfd4a1",
        "type": "inject",
        "z": "e4f8b2fae37c27e7",
        "name": "Turn off WLED",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 530,
        "y": 140,
        "wires": [
            [
                "ebc7c4fdbae32e13"
            ]
        ]
    },
    {
        "id": "eb836f8d7d24647b",
        "type": "inject",
        "z": "a951951f3950191b",
        "name": "Start Charging",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 360,
        "y": 420,
        "wires": [
            [
                "0165e4c506c5f8b3"
            ]
        ]
    },
    {
        "id": "a924e2004e52db99",
        "type": "mqtt out",
        "z": "a951951f3950191b",
        "name": "Science Room Desk Light",
        "topic": "cmnd/sonoff_smartswitch01/POWER",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1110,
        "y": 540,
        "wires": []
    },
    {
        "id": "17824bafcf935e65",
        "type": "ui_slider",
        "z": "a951951f3950191b",
        "name": "",
        "label": "Time in minutes",
        "tooltip": "",
        "group": "33977842a9fcae11",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "payload",
        "topicType": "msg",
        "min": 0,
        "max": "360",
        "step": "10",
        "className": "",
        "x": 120,
        "y": 180,
        "wires": [
            [
                "341eeb70e35c9979",
                "54e8211adc2b744b",
                "bbc64b66fdf0eb28"
            ]
        ]
    },
    {
        "id": "bc09f263cb3ce00c",
        "type": "debug",
        "z": "a951951f3950191b",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 820,
        "y": 300,
        "wires": []
    },
    {
        "id": "565221230794ce29",
        "type": "debug",
        "z": "a951951f3950191b",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "$flowContext('delay')",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 200,
        "wires": []
    },
    {
        "id": "1ac3677b3e3ecefa",
        "type": "ui_button",
        "z": "a951951f3950191b",
        "name": "",
        "group": "33977842a9fcae11",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Start charger",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "delay",
        "payloadType": "flow",
        "topic": "payload",
        "topicType": "msg",
        "x": 110,
        "y": 300,
        "wires": [
            [
                "f19e14306523e7ab",
                "cf831b8f1b62b385",
                "389611d48acb17b2",
                "1b8698c2cd35483b"
            ]
        ]
    },
    {
        "id": "0e63b5567ccef6e6",
        "type": "countdown",
        "z": "a951951f3950191b",
        "name": "",
        "topic": "",
        "payloadTimerStart": "ON",
        "payloadTimerStartType": "str",
        "payloadTimerStop": "OFF",
        "payloadTimerStopType": "str",
        "timer": "8",
        "resetWhileRunning": true,
        "outputOnReset": true,
        "setTimeToNewWhileRunning": true,
        "startCountdownOnControlMessage": true,
        "x": 510,
        "y": 600,
        "wires": [
            [
                "bc09f263cb3ce00c",
                "a924e2004e52db99"
            ],
            [
                "3c541276e5c10623",
                "949be46a30bcd788"
            ]
        ]
    },
    {
        "id": "3c541276e5c10623",
        "type": "debug",
        "z": "a951951f3950191b",
        "d": true,
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 740,
        "y": 520,
        "wires": []
    },
    {
        "id": "f19e14306523e7ab",
        "type": "debug",
        "z": "a951951f3950191b",
        "name": "debug 6",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1320,
        "y": 1000,
        "wires": []
    },
    {
        "id": "cf831b8f1b62b385",
        "type": "change",
        "z": "a951951f3950191b",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "control",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 480,
        "wires": [
            [
                "0e63b5567ccef6e6",
                "322eda184e20a487",
                "36979692c0c93a67"
            ]
        ]
    },
    {
        "id": "23af34a4f83f74ed",
        "type": "ui_gauge",
        "z": "a951951f3950191b",
        "name": "",
        "group": "33977842a9fcae11",
        "order": 2,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Remaining Time",
        "label": "Minutes",
        "format": "{{value}}",
        "min": 0,
        "max": "360",
        "colors": [
            "#00b500",
            "#00b400",
            "#00b400"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 980,
        "y": 700,
        "wires": []
    },
    {
        "id": "0165e4c506c5f8b3",
        "type": "trigger",
        "z": "a951951f3950191b",
        "name": "",
        "op1": "ON",
        "op2": "OFF",
        "op1type": "str",
        "op2type": "str",
        "duration": "6",
        "extend": true,
        "overrideDelay": true,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 640,
        "y": 300,
        "wires": [
            [
                "a924e2004e52db99",
                "bc09f263cb3ce00c"
            ]
        ]
    },
    {
        "id": "1b8698c2cd35483b",
        "type": "ui_switch",
        "z": "a951951f3950191b",
        "name": "",
        "label": "Charger Power",
        "tooltip": "",
        "group": "33977842a9fcae11",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "payload",
        "topicType": "msg",
        "style": "",
        "onvalue": "delay",
        "onvalueType": "flow",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 120,
        "y": 800,
        "wires": [
            [
                "f19e14306523e7ab",
                "cf831b8f1b62b385",
                "389611d48acb17b2",
                "0e63b5567ccef6e6"
            ]
        ]
    },
    {
        "id": "389611d48acb17b2",
        "type": "debug",
        "z": "a951951f3950191b",
        "name": "debug 8",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "topic",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 640,
        "y": 800,
        "wires": []
    },
    {
        "id": "322eda184e20a487",
        "type": "debug",
        "z": "a951951f3950191b",
        "name": "debug 9",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 540,
        "y": 480,
        "wires": []
    },
    {
        "id": "36979692c0c93a67",
        "type": "debug",
        "z": "a951951f3950191b",
        "name": "debug 10",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "topic",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 540,
        "y": 520,
        "wires": []
    },
    {
        "id": "8cb8f483f6e540ef",
        "type": "inject",
        "z": "a951951f3950191b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "control",
        "payload": "false",
        "payloadType": "bool",
        "x": 270,
        "y": 1000,
        "wires": [
            [
                "0e63b5567ccef6e6",
                "389611d48acb17b2",
                "f19e14306523e7ab"
            ]
        ]
    },
    {
        "id": "341eeb70e35c9979",
        "type": "function",
        "z": "a951951f3950191b",
        "name": "Set flow.delay",
        "func": "const flowVarName = 'delay';\nnode.warn(msg.payload);\nconst flowVarValue = msg.payload * 60;\nflow.set(flowVarName, flowVarValue);\nnode.warn('Delay set[' + flow.get(flowVarName) + ']');\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 180,
        "wires": [
            [
                "565221230794ce29"
            ]
        ]
    },
    {
        "id": "54e8211adc2b744b",
        "type": "debug",
        "z": "a951951f3950191b",
        "name": "debug 39",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 360,
        "y": 40,
        "wires": []
    },
    {
        "id": "bbc64b66fdf0eb28",
        "type": "change",
        "z": "a951951f3950191b",
        "d": true,
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "delay",
                "pt": "flow",
                "to": "payload*60",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 240,
        "wires": [
            [
                "565221230794ce29"
            ]
        ]
    },
    {
        "id": "949be46a30bcd788",
        "type": "function",
        "z": "a951951f3950191b",
        "name": "Divind and Round value",
        "func": "msg.payload = Math.ceil(msg.payload / 60);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 680,
        "wires": [
            [
                "23af34a4f83f74ed"
            ]
        ]
    },
    {
        "id": "ac50380556a62f9a",
        "type": "mqtt in",
        "z": "497313bae368cffb",
        "name": "",
        "topic": "zigbee2mqtt/PIR_SNZB-03_02",
        "qos": "0",
        "datatype": "json",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 180,
        "wires": [
            [
                "7a8df6b07aa0262c"
            ]
        ]
    },
    {
        "id": "eef48e620186b63d",
        "type": "mqtt in",
        "z": "497313bae368cffb",
        "name": "",
        "topic": "zigbee2mqtt/PIR_SNZB-03_01",
        "qos": "0",
        "datatype": "json",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 120,
        "wires": [
            [
                "7a8df6b07aa0262c"
            ]
        ]
    },
    {
        "id": "e8f77b7c5d8cd17b",
        "type": "mqtt in",
        "z": "497313bae368cffb",
        "name": "",
        "topic": "zigbee2mqtt/PIR_Aqara_01",
        "qos": "0",
        "datatype": "json",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 160,
        "y": 60,
        "wires": [
            [
                "7a8df6b07aa0262c"
            ]
        ]
    },
    {
        "id": "7a8df6b07aa0262c",
        "type": "switch",
        "z": "497313bae368cffb",
        "name": "occupancy",
        "property": "payload.occupancy",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "neq",
                "v": "true",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 550,
        "y": 120,
        "wires": [
            [
                "cda0c6826309adb6"
            ],
            []
        ]
    },
    {
        "id": "cda0c6826309adb6",
        "type": "change",
        "z": "497313bae368cffb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "3600",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "control",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 120,
        "wires": [
            [
                "b2aeb863462c101a"
            ]
        ]
    },
    {
        "id": "b2aeb863462c101a",
        "type": "countdown",
        "z": "497313bae368cffb",
        "name": "",
        "topic": "",
        "payloadTimerStart": "true",
        "payloadTimerStartType": "bool",
        "payloadTimerStop": "false",
        "payloadTimerStopType": "bool",
        "timer": "10",
        "resetWhileRunning": true,
        "outputOnReset": true,
        "setTimeToNewWhileRunning": true,
        "startCountdownOnControlMessage": true,
        "x": 970,
        "y": 120,
        "wires": [
            [
                "30b13dc40742c370"
            ],
            []
        ]
    },
    {
        "id": "b8253e36d64828fb",
        "type": "mqtt out",
        "z": "497313bae368cffb",
        "d": true,
        "name": "",
        "topic": "zigbee2mqtt/Bulb_Ikea_02/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1894,
        "y": 163,
        "wires": []
    },
    {
        "id": "676bc57d374ccf3d",
        "type": "mqtt out",
        "z": "497313bae368cffb",
        "d": true,
        "name": "",
        "topic": "zigbee2mqtt/Bulb_Ikea_01/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1894,
        "y": 121,
        "wires": []
    },
    {
        "id": "afd370d6729f0f7e",
        "type": "mqtt out",
        "z": "497313bae368cffb",
        "d": true,
        "name": "",
        "topic": "cmnd/sonoff_smartswitch01/POWER",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1914,
        "y": 204,
        "wires": []
    },
    {
        "id": "55f238a16166a01a",
        "type": "mqtt out",
        "z": "497313bae368cffb",
        "d": true,
        "name": "Kids Room Ceiling Light",
        "topic": "zigbee2mqtt/RELAY_BASICZBR3/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1874,
        "y": 244,
        "wires": []
    },
    {
        "id": "30b13dc40742c370",
        "type": "switch",
        "z": "497313bae368cffb",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1150,
        "y": 114,
        "wires": [
            [
                "7e3f583ee1281f60"
            ]
        ]
    },
    {
        "id": "7e3f583ee1281f60",
        "type": "change",
        "z": "497313bae368cffb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "OFF",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1340,
        "y": 120,
        "wires": [
            [
                "2379fa079eaeaafd",
                "6ff6fca09dc2d874",
                "73b4118966e013a6",
                "327bd5511648aad6"
            ]
        ]
    },
    {
        "id": "2379fa079eaeaafd",
        "type": "function",
        "z": "497313bae368cffb",
        "d": true,
        "name": "isPowerON?",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1614,
        "y": 120,
        "wires": [
            [
                "676bc57d374ccf3d"
            ]
        ]
    },
    {
        "id": "6ff6fca09dc2d874",
        "type": "function",
        "z": "497313bae368cffb",
        "d": true,
        "name": "isPowerON?",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1614,
        "y": 163,
        "wires": [
            [
                "b8253e36d64828fb"
            ]
        ]
    },
    {
        "id": "73b4118966e013a6",
        "type": "function",
        "z": "497313bae368cffb",
        "d": true,
        "name": "isPowerON?",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1614,
        "y": 203,
        "wires": [
            [
                "afd370d6729f0f7e"
            ]
        ]
    },
    {
        "id": "327bd5511648aad6",
        "type": "function",
        "z": "497313bae368cffb",
        "d": true,
        "name": "isPowerON?",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1614,
        "y": 243,
        "wires": [
            [
                "55f238a16166a01a"
            ]
        ]
    },
    {
        "id": "464c3061dafb2630",
        "type": "mqtt in",
        "z": "497313bae368cffb",
        "name": "",
        "topic": "tele/sonoff_smartswitch01/STATE",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 170,
        "y": 340,
        "wires": [
            [
                "6e5c235d8a2db346"
            ]
        ]
    },
    {
        "id": "6e5c235d8a2db346",
        "type": "function",
        "z": "497313bae368cffb",
        "name": "Set Power Status",
        "func": "const globalVarName = 'sonoff_smartswitch01';\nnode.warn(msg.payload);\nconst globalVarValue = {    \n    \"isPowerOn\" : false\n};\nif (msg.payload.POWER === 'ON') {\n    globalVarValue.isPowerOn = true;    \n} else if (msg.payload.POWER === 'OFF') {\n    globalVarValue.isPowerOn = false;\n} else {\n    node.error('Wrong payload [' + msg.payload + ']');\n}\n\nglobal.set(globalVarName, globalVarValue);    \n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "a0e6afadf433511e",
        "type": "debug",
        "z": "7ea9894b62d00340",
        "d": true,
        "name": "debug 48",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1000,
        "y": 180,
        "wires": []
    },
    {
        "id": "29d8b5f36082c1f6",
        "type": "subflow:47ad76887e14580c",
        "z": "7ea9894b62d00340",
        "name": "",
        "env": [
            {
                "name": "PIR_TOPIC",
                "value": "zigbee2mqtt/PIR_SNZB-03_02",
                "type": "str"
            },
            {
                "name": "PIR_TIMEOUT",
                "value": "9",
                "type": "num"
            }
        ],
        "x": 700,
        "y": 100,
        "wires": [
            [
                "a0e6afadf433511e",
                "90c10a8f204e2451"
            ],
            [
                "e0be4e7ced6b1f95",
                "c705edd9ba8dd828"
            ]
        ]
    },
    {
        "id": "c162f74487f12375",
        "type": "inject",
        "z": "7ea9894b62d00340",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":true,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 190,
        "y": 100,
        "wires": [
            [
                "29d8b5f36082c1f6"
            ]
        ]
    },
    {
        "id": "3c1fc5e2ac471393",
        "type": "inject",
        "z": "7ea9894b62d00340",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":false,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 170,
        "y": 160,
        "wires": [
            [
                "29d8b5f36082c1f6"
            ]
        ]
    },
    {
        "id": "e0be4e7ced6b1f95",
        "type": "debug",
        "z": "7ea9894b62d00340",
        "d": true,
        "name": "debug 53",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1000,
        "y": 260,
        "wires": []
    },
    {
        "id": "fe0d2b9f395b1070",
        "type": "inject",
        "z": "7ea9894b62d00340",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 190,
        "y": 300,
        "wires": [
            [
                "67cad71bb08fe35c"
            ]
        ]
    },
    {
        "id": "67cad71bb08fe35c",
        "type": "function",
        "z": "7ea9894b62d00340",
        "name": "function 1",
        "func": "if (msg.payload) {\n    return [null, msg];\n}\nmsg.payload = false\nreturn [null, null];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 300,
        "wires": [
            [
                "a0e6afadf433511e"
            ],
            [
                "e0be4e7ced6b1f95"
            ]
        ]
    },
    {
        "id": "d8e1773d5bd79dd6",
        "type": "inject",
        "z": "7ea9894b62d00340",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "300",
        "payloadType": "num",
        "x": 256,
        "y": 360,
        "wires": [
            [
                "67cad71bb08fe35c",
                "e79873fd26ea8662",
                "e805ea5850506f2f"
            ]
        ]
    },
    {
        "id": "c705edd9ba8dd828",
        "type": "trigger",
        "z": "7ea9894b62d00340",
        "name": "",
        "op1": "ON",
        "op2": "OFF",
        "op1type": "str",
        "op2type": "str",
        "duration": "5",
        "extend": true,
        "overrideDelay": false,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 2,
        "x": 1160,
        "y": 140,
        "wires": [
            [
                "cb29fa7852062a3d"
            ],
            [
                "90c10a8f204e2451"
            ]
        ]
    },
    {
        "id": "90c10a8f204e2451",
        "type": "debug",
        "z": "7ea9894b62d00340",
        "name": "Bulb",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1310,
        "y": 40,
        "wires": []
    },
    {
        "id": "cb29fa7852062a3d",
        "type": "debug",
        "z": "7ea9894b62d00340",
        "d": true,
        "name": "debug 57",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1400,
        "y": 120,
        "wires": []
    },
    {
        "id": "e79873fd26ea8662",
        "type": "change",
        "z": "7ea9894b62d00340",
        "name": "Set night light",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t   \"state\": \"ON\",\t   \"brightness\": $flowContext('BULB'),\t   \"color_temp\": \"neutral\"\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "e805ea5850506f2f",
        "type": "function",
        "z": "7ea9894b62d00340",
        "name": "function 2",
        "func": "// $flowContext('BULB')\nconst val = flow.get(\"BULB\");\nflow.set(\"BULB\", val + 1);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 360,
        "wires": [
            [
                "f8369892f5363b29"
            ]
        ]
    },
    {
        "id": "f8369892f5363b29",
        "type": "debug",
        "z": "7ea9894b62d00340",
        "name": "debug 62",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 720,
        "y": 360,
        "wires": []
    },
    {
        "id": "94ff34b0385cee67",
        "type": "debug",
        "z": "7ea9894b62d00340",
        "name": "III",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 810,
        "y": 740,
        "wires": []
    },
    {
        "id": "87e2059fe7dc8602",
        "type": "debug",
        "z": "7ea9894b62d00340",
        "name": "I",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 810,
        "y": 680,
        "wires": []
    },
    {
        "id": "e54a9a1ec3ccef6c",
        "type": "inject",
        "z": "7ea9894b62d00340",
        "name": "occupancy illuminance_lux 200",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":true,\"tamper\":false,\"voltage\":3000,\"illuminance_lux\":200}",
        "payloadType": "json",
        "x": 230,
        "y": 720,
        "wires": [
            [
                "b507f820e52d9de6"
            ]
        ]
    },
    {
        "id": "78446479a4b605b9",
        "type": "inject",
        "z": "7ea9894b62d00340",
        "name": "occupancy illuminance_lux 10",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":true,\"tamper\":false,\"voltage\":3000,\"illuminance_lux\":10}",
        "payloadType": "json",
        "x": 220,
        "y": 760,
        "wires": [
            [
                "b507f820e52d9de6"
            ]
        ]
    },
    {
        "id": "b507f820e52d9de6",
        "type": "subflow:ce92b488da80a9bb",
        "z": "7ea9894b62d00340",
        "d": true,
        "name": "",
        "env": [
            {
                "name": "TIMEOUT",
                "value": "8",
                "type": "num"
            },
            {
                "name": "NIGHT_BRIGHTNESS",
                "value": "149",
                "type": "num"
            },
            {
                "name": "NIGHT_TIME",
                "value": "23:59",
                "type": "str"
            }
        ],
        "x": 550,
        "y": 700,
        "wires": [
            [
                "87e2059fe7dc8602"
            ],
            [
                "94ff34b0385cee67"
            ]
        ]
    },
    {
        "id": "fed3a4c53d854b37",
        "type": "inject",
        "z": "7ea9894b62d00340",
        "name": "occupancy true",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":true,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 180,
        "y": 600,
        "wires": [
            [
                "b507f820e52d9de6",
                "bfc7caafb63cf070"
            ]
        ]
    },
    {
        "id": "58e7e25a18550829",
        "type": "inject",
        "z": "7ea9894b62d00340",
        "name": "occupancy false",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":false,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 200,
        "y": 660,
        "wires": [
            [
                "b507f820e52d9de6",
                "bfc7caafb63cf070"
            ]
        ]
    },
    {
        "id": "8b8a1a36e583f322",
        "type": "debug",
        "z": "7ea9894b62d00340",
        "d": true,
        "name": "YES",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1790,
        "y": 260,
        "wires": []
    },
    {
        "id": "f83c662fe1946659",
        "type": "debug",
        "z": "7ea9894b62d00340",
        "d": true,
        "name": "NO",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1790,
        "y": 320,
        "wires": []
    },
    {
        "id": "9b2927504ff5e025",
        "type": "bigtimer",
        "z": "7ea9894b62d00340",
        "outtopic": "",
        "outpayload1": "",
        "outpayload2": "",
        "name": "Big Timer",
        "comment": "",
        "lat": 0,
        "lon": 0,
        "starttime": 5001,
        "endtime": 1425,
        "starttime2": 0,
        "endtime2": 0,
        "startoff": 0,
        "endoff": 0,
        "startoff2": 0,
        "endoff2": 0,
        "offs": 0,
        "outtext1": "",
        "outtext2": "",
        "timeout": 1440,
        "sun": true,
        "mon": true,
        "tue": true,
        "wed": true,
        "thu": true,
        "fri": true,
        "sat": true,
        "jan": true,
        "feb": true,
        "mar": true,
        "apr": true,
        "may": true,
        "jun": true,
        "jul": true,
        "aug": true,
        "sep": true,
        "oct": true,
        "nov": true,
        "dec": true,
        "day1": 0,
        "month1": 0,
        "day2": 0,
        "month2": 0,
        "day3": 0,
        "month3": 0,
        "day4": 0,
        "month4": 0,
        "day5": 0,
        "month5": 0,
        "day6": 0,
        "month6": 0,
        "day7": 0,
        "month7": 0,
        "day8": 0,
        "month8": 0,
        "day9": 0,
        "month9": 0,
        "day10": 0,
        "month10": 0,
        "day11": 0,
        "month11": 0,
        "day12": 0,
        "month12": 0,
        "d1": 0,
        "w1": 0,
        "d2": 0,
        "w2": 0,
        "d3": 0,
        "w3": 0,
        "d4": 0,
        "w4": 0,
        "d5": 0,
        "w5": 0,
        "d6": 0,
        "w6": 0,
        "xday1": 0,
        "xmonth1": 0,
        "xday2": 0,
        "xmonth2": 0,
        "xday3": 0,
        "xmonth3": 0,
        "xday4": 0,
        "xmonth4": 0,
        "xday5": 0,
        "xmonth5": 0,
        "xday6": 0,
        "xmonth6": 0,
        "xday7": 0,
        "xmonth7": 0,
        "xday8": 0,
        "xmonth8": 0,
        "xday9": 0,
        "xmonth9": 0,
        "xday10": 0,
        "xmonth10": 0,
        "xday11": 0,
        "xmonth11": 0,
        "xday12": 0,
        "xmonth12": 0,
        "xd1": 0,
        "xw1": 0,
        "xd2": 0,
        "xw2": 0,
        "xd3": 0,
        "xw3": 0,
        "xd4": 0,
        "xw4": 0,
        "xd5": 0,
        "xw5": 0,
        "xd6": 0,
        "xw6": 0,
        "suspend": false,
        "random": false,
        "randon1": false,
        "randoff1": false,
        "randon2": false,
        "randoff2": false,
        "repeat": true,
        "atstart": true,
        "odd": false,
        "even": false,
        "x": 840,
        "y": 540,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "bfc7caafb63cf070",
        "type": "subflow:cb7cf013bfa17c66",
        "z": "7ea9894b62d00340",
        "name": "",
        "env": [
            {
                "name": "NIGHT_BRIGHTNESS",
                "value": "1",
                "type": "num"
            }
        ],
        "x": 1440,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "ac25ae4779891bf4",
        "type": "mqtt in",
        "z": "bc52afb68bb2be89",
        "name": "1st floor PIR",
        "topic": "zigbee2mqtt/PIR_SNZB-03_02",
        "qos": "0",
        "datatype": "json",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 140,
        "wires": [
            [
                "5800e9d3ad04828f"
            ]
        ]
    },
    {
        "id": "4435c8204398e6b4",
        "type": "subflow:c36763b8799fc77d",
        "z": "bc52afb68bb2be89",
        "name": "",
        "env": [
            {
                "name": "NIGHT_BRIGHTNESS",
                "value": "150",
                "type": "num"
            },
            {
                "name": "BRIGHTNESS",
                "value": "150",
                "type": "num"
            }
        ],
        "x": 627,
        "y": 120,
        "wires": [
            [
                "728ece8d025a537e",
                "f7fbe38e55d13b90",
                "2890db1a05f5980b"
            ]
        ]
    },
    {
        "id": "728ece8d025a537e",
        "type": "mqtt out",
        "z": "bc52afb68bb2be89",
        "name": "1st floor bulb",
        "topic": "zigbee2mqtt/Bulb_Ikea_01/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 850,
        "y": 160,
        "wires": []
    },
    {
        "id": "fe96c9a854828c7f",
        "type": "countdown",
        "z": "bc52afb68bb2be89",
        "name": "",
        "topic": "",
        "payloadTimerStart": "",
        "payloadTimerStartType": "nul",
        "payloadTimerStop": "{\"state\":\"OFF\",\"transition\":10}",
        "payloadTimerStopType": "json",
        "timer": "120",
        "resetWhileRunning": true,
        "outputOnReset": false,
        "setTimeToNewWhileRunning": true,
        "startCountdownOnControlMessage": true,
        "x": 610,
        "y": 240,
        "wires": [
            [
                "728ece8d025a537e",
                "09b8a68575d15c20",
                "6457c1026acdbd41"
            ],
            [
                "2517829d57a8bcbb"
            ]
        ]
    },
    {
        "id": "be03254ba68e3f71",
        "type": "change",
        "z": "bc52afb68bb2be89",
        "name": "stop timer",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 600,
        "y": 165,
        "wires": [
            [
                "fe96c9a854828c7f"
            ]
        ]
    },
    {
        "id": "5800e9d3ad04828f",
        "type": "switch",
        "z": "bc52afb68bb2be89",
        "name": "occupancy",
        "property": "payload.occupancy",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "neq",
                "v": "true",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 385,
        "y": 140,
        "wires": [
            [
                "be03254ba68e3f71",
                "4435c8204398e6b4"
            ],
            [
                "fe96c9a854828c7f"
            ]
        ]
    },
    {
        "id": "bde78d04719e27ec",
        "type": "inject",
        "z": "bc52afb68bb2be89",
        "name": "occupancy true",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":true,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 120,
        "y": 260,
        "wires": [
            [
                "5800e9d3ad04828f"
            ]
        ]
    },
    {
        "id": "4a30e053e78632bd",
        "type": "inject",
        "z": "bc52afb68bb2be89",
        "name": "occupancy false",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":false,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 120,
        "y": 320,
        "wires": [
            [
                "5800e9d3ad04828f"
            ]
        ]
    },
    {
        "id": "f7fbe38e55d13b90",
        "type": "debug",
        "z": "bc52afb68bb2be89",
        "name": "debug 68",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1100,
        "y": 60,
        "wires": []
    },
    {
        "id": "09b8a68575d15c20",
        "type": "debug",
        "z": "bc52afb68bb2be89",
        "name": "debug 69",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1100,
        "y": 180,
        "wires": []
    },
    {
        "id": "61b827cbae107273",
        "type": "ui_gauge",
        "z": "bc52afb68bb2be89",
        "name": "",
        "group": "3b825d13cf529239",
        "order": 2,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "{{msg.topic}}",
        "label": "Seconds",
        "format": "{{value}}",
        "min": 0,
        "max": "300",
        "colors": [
            "#fff700",
            "#fff700",
            "#fff700"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1630,
        "y": 220,
        "wires": []
    },
    {
        "id": "2890db1a05f5980b",
        "type": "change",
        "z": "bc52afb68bb2be89",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "I Floor Light is ON",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1280,
        "y": 120,
        "wires": [
            [
                "61b827cbae107273"
            ]
        ]
    },
    {
        "id": "410f098179736fde",
        "type": "change",
        "z": "bc52afb68bb2be89",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "I Floor Light is OFF",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1280,
        "y": 220,
        "wires": [
            [
                "61b827cbae107273"
            ]
        ]
    },
    {
        "id": "2517829d57a8bcbb",
        "type": "change",
        "z": "bc52afb68bb2be89",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "I Floor Light is ON",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1280,
        "y": 280,
        "wires": [
            [
                "61b827cbae107273"
            ]
        ]
    },
    {
        "id": "6457c1026acdbd41",
        "type": "delay",
        "z": "bc52afb68bb2be89",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1100,
        "y": 220,
        "wires": [
            [
                "410f098179736fde"
            ]
        ]
    },
    {
        "id": "6fa71d2ca82b77c7",
        "type": "mqtt in",
        "z": "bc52afb68bb2be89",
        "d": true,
        "name": "Button 01",
        "topic": "zigbee2mqtt/Button01_SNZB-01",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 160,
        "y": 460,
        "wires": [
            [
                "4ec073cdb4821982"
            ]
        ]
    },
    {
        "id": "1d4fd0f75f4afc1c",
        "type": "debug",
        "z": "bc52afb68bb2be89",
        "name": "single",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 440,
        "wires": []
    },
    {
        "id": "4ec073cdb4821982",
        "type": "switch",
        "z": "bc52afb68bb2be89",
        "name": "",
        "property": "payload.action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "single",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "double",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "long",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 490,
        "y": 460,
        "wires": [
            [
                "0bc68557a329a433",
                "1d4fd0f75f4afc1c"
            ],
            [
                "944bdce535d7b89c"
            ],
            [
                "535c50cb766dfc8d"
            ]
        ]
    },
    {
        "id": "944bdce535d7b89c",
        "type": "debug",
        "z": "bc52afb68bb2be89",
        "name": "double",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 480,
        "wires": []
    },
    {
        "id": "535c50cb766dfc8d",
        "type": "debug",
        "z": "bc52afb68bb2be89",
        "name": "long",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 520,
        "wires": []
    },
    {
        "id": "0bc68557a329a433",
        "type": "change",
        "z": "bc52afb68bb2be89",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"state\":\"TOGGLE\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 720,
        "y": 400,
        "wires": [
            [
                "728ece8d025a537e"
            ]
        ]
    },
    {
        "id": "66075c4940158c4b",
        "type": "inject",
        "z": "03d0df180b773622",
        "name": "occupancy true",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":true,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 180,
        "y": 380,
        "wires": [
            [
                "c92930ebbbeb4a77"
            ]
        ]
    },
    {
        "id": "3dbcd206fc1b186e",
        "type": "inject",
        "z": "03d0df180b773622",
        "name": "occupancy false",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":false,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 180,
        "y": 420,
        "wires": [
            [
                "c92930ebbbeb4a77"
            ]
        ]
    },
    {
        "id": "cdca956567d348eb",
        "type": "ui_gauge",
        "z": "03d0df180b773622",
        "name": "",
        "group": "3b825d13cf529239",
        "order": 3,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "{{msg.topic}}",
        "label": "Seconds",
        "format": "{{value}}",
        "min": 0,
        "max": "300",
        "colors": [
            "#fff700",
            "#fff700",
            "#fff700"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1170,
        "y": 360,
        "wires": []
    },
    {
        "id": "93e20dd105528b91",
        "type": "change",
        "z": "03d0df180b773622",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "I Floor Light is ON",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "300",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 940,
        "y": 320,
        "wires": [
            [
                "cdca956567d348eb"
            ]
        ]
    },
    {
        "id": "c92930ebbbeb4a77",
        "type": "subflow:ce92b488da80a9bb",
        "z": "03d0df180b773622",
        "name": "",
        "env": [
            {
                "name": "TIMEOUT",
                "value": "120",
                "type": "num"
            },
            {
                "name": "NIGHT_TIME",
                "value": "21:30",
                "type": "str"
            },
            {
                "name": "NIGHT_TIMEOUT",
                "value": "120",
                "type": "num"
            }
        ],
        "x": 470,
        "y": 320,
        "wires": [
            [
                "e214e0555134d412",
                "fef17986287c6a93"
            ],
            [
                "2eefa43b4c7cb9d7"
            ]
        ]
    },
    {
        "id": "9943e758bfff911c",
        "type": "mqtt in",
        "z": "03d0df180b773622",
        "name": "1st floor PIR",
        "topic": "zigbee2mqtt/PIR_SNZB-03_02",
        "qos": "0",
        "datatype": "json",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 320,
        "wires": [
            [
                "c92930ebbbeb4a77"
            ]
        ]
    },
    {
        "id": "2eefa43b4c7cb9d7",
        "type": "change",
        "z": "03d0df180b773622",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "I Floor Light is ON",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 420,
        "wires": [
            [
                "cdca956567d348eb"
            ]
        ]
    },
    {
        "id": "e214e0555134d412",
        "type": "switch",
        "z": "03d0df180b773622",
        "name": "",
        "property": "payload.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ON",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 710,
        "y": 340,
        "wires": [
            [
                "93e20dd105528b91"
            ],
            [
                "db1c1ccdc53cc350"
            ]
        ]
    },
    {
        "id": "db1c1ccdc53cc350",
        "type": "change",
        "z": "03d0df180b773622",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "I Floor Light is OFF",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 940,
        "y": 360,
        "wires": [
            [
                "cdca956567d348eb"
            ]
        ]
    },
    {
        "id": "fef17986287c6a93",
        "type": "mqtt out",
        "z": "03d0df180b773622",
        "name": "1st floor stairs bulb",
        "topic": "zigbee2mqtt/Bulb_Linkind_01/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 810,
        "y": 60,
        "wires": []
    },
    {
        "id": "c7c218bf05924d42",
        "type": "inject",
        "z": "03d0df180b773622",
        "name": "coolest",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"state\":\"ON\",\"brightness\":200,\"color_temp\":\"coolest\"}",
        "payloadType": "json",
        "x": 450,
        "y": 60,
        "wires": [
            [
                "fef17986287c6a93"
            ]
        ]
    },
    {
        "id": "0006e148d7cab654",
        "type": "inject",
        "z": "03d0df180b773622",
        "name": "cool",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"state\":\"ON\",\"brightness\":200,\"color_temp\":\"cool\"}",
        "payloadType": "json",
        "x": 450,
        "y": 100,
        "wires": [
            [
                "fef17986287c6a93"
            ]
        ]
    },
    {
        "id": "c5bd25d8c0e64079",
        "type": "inject",
        "z": "03d0df180b773622",
        "name": "neutral",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"state\":\"ON\",\"brightness\":200,\"color_temp\":\"neutral\"}",
        "payloadType": "json",
        "x": 450,
        "y": 140,
        "wires": [
            [
                "fef17986287c6a93"
            ]
        ]
    },
    {
        "id": "d065d0bb2412f5d7",
        "type": "inject",
        "z": "03d0df180b773622",
        "name": "warmest",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"state\":\"ON\",\"brightness\":200,\"color_temp\":\"warm\"}",
        "payloadType": "json",
        "x": 440,
        "y": 220,
        "wires": [
            [
                "fef17986287c6a93"
            ]
        ]
    },
    {
        "id": "1102d03bfc0a1dc4",
        "type": "inject",
        "z": "03d0df180b773622",
        "name": "300",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"state\":\"ON\",\"brightness\":150,\"color_temp\":340}",
        "payloadType": "json",
        "x": 450,
        "y": 260,
        "wires": [
            [
                "fef17986287c6a93"
            ]
        ]
    },
    {
        "id": "e5c43dfd77171378",
        "type": "inject",
        "z": "03d0df180b773622",
        "name": "warm",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"state\":\"ON\",\"brightness\":200,\"color_temp\":\"warm\"}",
        "payloadType": "json",
        "x": 450,
        "y": 180,
        "wires": [
            [
                "fef17986287c6a93"
            ]
        ]
    },
    {
        "id": "66c72f7a0fb65f94",
        "type": "mqtt in",
        "z": "4769076e30583f2e",
        "name": "Button 02",
        "topic": "zigbee2mqtt/Button02_SNZB-01",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 120,
        "y": 200,
        "wires": [
            [
                "865e0d0388303869"
            ]
        ]
    },
    {
        "id": "34e23ac3af5d60bc",
        "type": "debug",
        "z": "4769076e30583f2e",
        "name": "single",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 570,
        "y": 120,
        "wires": []
    },
    {
        "id": "865e0d0388303869",
        "type": "switch",
        "z": "4769076e30583f2e",
        "name": "",
        "property": "payload.action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "single",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "double",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "long",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 250,
        "y": 340,
        "wires": [
            [
                "34e23ac3af5d60bc",
                "badb9afa71a7f63d",
                "b3c775624110b84e"
            ],
            [
                "1649bf45b1ca9891",
                "78cb806cb93dd956",
                "54a61e4e54b48c93"
            ],
            [
                "179d6ed53886bffc",
                "56b41d414e8f0704",
                "bf0f48150a0f84ce",
                "8cf9ccb3cc1c1383",
                "71e19d5b3f58ba9c"
            ]
        ]
    },
    {
        "id": "1649bf45b1ca9891",
        "type": "debug",
        "z": "4769076e30583f2e",
        "name": "double",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 570,
        "y": 160,
        "wires": []
    },
    {
        "id": "179d6ed53886bffc",
        "type": "debug",
        "z": "4769076e30583f2e",
        "name": "long",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 570,
        "y": 200,
        "wires": []
    },
    {
        "id": "56b41d414e8f0704",
        "type": "change",
        "z": "4769076e30583f2e",
        "name": "long: off",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"state\":\"OFF\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 600,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "40c81fd7a5155e0d",
        "type": "mqtt out",
        "z": "4769076e30583f2e",
        "name": "ground floor bulb stairs bulb",
        "topic": "zigbee2mqtt/Bulb_Ikea_01/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1080,
        "y": 720,
        "wires": []
    },
    {
        "id": "a42694da92fb5aab",
        "type": "mqtt out",
        "z": "4769076e30583f2e",
        "name": "Kids Room Ceiling Light",
        "topic": "zigbee2mqtt/RELAY_BASICZBR3/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1130,
        "y": 260,
        "wires": []
    },
    {
        "id": "2d81aae9b57cc553",
        "type": "mqtt out",
        "z": "4769076e30583f2e",
        "name": "2nd floor stairs bulb",
        "topic": "zigbee2mqtt/Bulb_Ikea_02/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1440,
        "y": 320,
        "wires": []
    },
    {
        "id": "b6c56d0b09e7d20b",
        "type": "mqtt out",
        "z": "4769076e30583f2e",
        "name": "kids' desk",
        "topic": "cmnd/sonoff_smartswitch01/POWER",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1030,
        "y": 420,
        "wires": []
    },
    {
        "id": "bf0f48150a0f84ce",
        "type": "change",
        "z": "4769076e30583f2e",
        "name": "long: off switch",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "OFF",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "54a61e4e54b48c93",
        "type": "change",
        "z": "4769076e30583f2e",
        "name": "double: toggle switch",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "TOGGLE",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "badb9afa71a7f63d",
        "type": "change",
        "z": "4769076e30583f2e",
        "d": true,
        "name": "toggle",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"state\":\"TOGGLE\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "78cb806cb93dd956",
        "type": "change",
        "z": "4769076e30583f2e",
        "name": "double: toggle",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"state\":\"TOGGLE\",\"color_temp\":\"neutral\",\"brightness\":254}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 600,
        "y": 320,
        "wires": [
            [
                "2d81aae9b57cc553"
            ]
        ]
    },
    {
        "id": "b3c775624110b84e",
        "type": "change",
        "z": "4769076e30583f2e",
        "name": "single: toggle",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"state\":\"TOGGLE\",\"color_temp\":\"neutral\",\"brightness\":254}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 260,
        "wires": [
            [
                "a42694da92fb5aab",
                "1f6185e980a0d76e",
                "136403ce4e140cb3"
            ]
        ]
    },
    {
        "id": "aa316b7fd2b8b689",
        "type": "mqtt out",
        "z": "4769076e30583f2e",
        "name": "1st floor bulb",
        "topic": "zigbee2mqtt/Bulb_Linkind_01/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1030,
        "y": 660,
        "wires": []
    },
    {
        "id": "e28638793216f8fb",
        "type": "mqtt out",
        "z": "4769076e30583f2e",
        "name": "ground floor bulb door",
        "topic": "zigbee2mqtt/Bulb_Linkind_02/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1060,
        "y": 600,
        "wires": []
    },
    {
        "id": "8cf9ccb3cc1c1383",
        "type": "change",
        "z": "4769076e30583f2e",
        "name": "long: toggle",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"state\":\"TOGGLE\",\"color_temp\":\"neutral\",\"brightness\":254}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 610,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "71e19d5b3f58ba9c",
        "type": "change",
        "z": "4769076e30583f2e",
        "name": "long: toggle switch",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "TOGGLE",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 420,
        "wires": [
            [
                "b6c56d0b09e7d20b"
            ]
        ]
    },
    {
        "id": "1f6185e980a0d76e",
        "type": "countdown",
        "z": "4769076e30583f2e",
        "g": "64b9e597ca308567",
        "name": "",
        "topic": "",
        "payloadTimerStart": "true",
        "payloadTimerStartType": "bool",
        "payloadTimerStop": "false",
        "payloadTimerStopType": "bool",
        "timer": "1800",
        "resetWhileRunning": true,
        "outputOnReset": true,
        "setTimeToNewWhileRunning": true,
        "startCountdownOnControlMessage": true,
        "x": 1030,
        "y": 140,
        "wires": [
            [
                "8a638e9042079b6f"
            ],
            []
        ]
    },
    {
        "id": "8a638e9042079b6f",
        "type": "function",
        "z": "4769076e30583f2e",
        "g": "64b9e597ca308567",
        "name": "disable PIR_Aqara_01 for 300 min",
        "func": "// node.error(`msg payload[${msg.payload}]`);\n// const payloadValue = (msg.payload === true);\nglobal.set('disable_PIR_Aqara_01', msg.payload);\nnode.error('disable_PIR_Aqara_01 [' + global.get('disable_PIR_Aqara_01') + ']');\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1280,
        "y": 120,
        "wires": [
            []
        ],
        "info": "disable PIR_Aqara_01 for 15 min when ceiling light was toggled manually"
    },
    {
        "id": "a724518bce1eeec4",
        "type": "inject",
        "z": "4769076e30583f2e",
        "name": "single",
        "props": [
            {
                "p": "payload.action",
                "v": "single",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 170,
        "y": 500,
        "wires": [
            [
                "865e0d0388303869"
            ]
        ]
    },
    {
        "id": "136403ce4e140cb3",
        "type": "debug",
        "z": "4769076e30583f2e",
        "name": "debug 85",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1100,
        "y": 220,
        "wires": []
    },
    {
        "id": "f138b1462c1acee7",
        "type": "ui_button",
        "z": "4769076e30583f2e",
        "name": "",
        "group": "3b825d13cf529239",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Lights OFF",
        "tooltip": "Turn off all lights",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "lightbulb_outline",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 310,
        "y": 700,
        "wires": [
            [
                "d3cc833bae983bb2",
                "767a784099c7d754"
            ]
        ]
    },
    {
        "id": "d3cc833bae983bb2",
        "type": "change",
        "z": "4769076e30583f2e",
        "name": "off switch",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "OFF",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 660,
        "wires": [
            [
                "b6c56d0b09e7d20b"
            ]
        ]
    },
    {
        "id": "767a784099c7d754",
        "type": "change",
        "z": "4769076e30583f2e",
        "name": "off zigbee",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"state\":\"OFF\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 740,
        "wires": [
            [
                "aa316b7fd2b8b689",
                "e28638793216f8fb",
                "40c81fd7a5155e0d",
                "2d81aae9b57cc553",
                "a42694da92fb5aab"
            ]
        ]
    },
    {
        "id": "761752eb212b75d2",
        "type": "comment",
        "z": "4769076e30583f2e",
        "g": "64b9e597ca308567",
        "name": "disable PIR_Aqara_01 for 15 min when ceiling light was toggled manually",
        "info": "",
        "x": 1200,
        "y": 60,
        "wires": []
    },
    {
        "id": "734d8381c14eb46f",
        "type": "mqtt in",
        "z": "e86e32e3984d7a10",
        "name": "",
        "topic": "zigbee2mqtt/door",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 250,
        "y": 120,
        "wires": [
            [
                "002a5eb6eb650ca6"
            ]
        ]
    },
    {
        "id": "a338d9883711a43f",
        "type": "e-mail",
        "z": "e86e32e3984d7a10",
        "server": "smtp.gmail.com",
        "port": "465",
        "secure": true,
        "tls": true,
        "name": "x5ht7lb6@duck.com",
        "dname": "",
        "x": 880,
        "y": 120,
        "wires": []
    },
    {
        "id": "809ced3214fe050a",
        "type": "change",
        "z": "e86e32e3984d7a10",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "open",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Front door",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 120,
        "wires": [
            [
                "a338d9883711a43f"
            ]
        ]
    },
    {
        "id": "002a5eb6eb650ca6",
        "type": "switch",
        "z": "e86e32e3984d7a10",
        "name": "",
        "property": "payload.contact",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 450,
        "y": 120,
        "wires": [
            [
                "809ced3214fe050a",
                "bfc8df5c1a440313"
            ]
        ]
    },
    {
        "id": "d78c328af49deaf2",
        "type": "inject",
        "z": "e86e32e3984d7a10",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"contact\":false,\"linkquality\":63,\"tamper\":false,\"voltage\":3100}",
        "payloadType": "json",
        "x": 210,
        "y": 200,
        "wires": [
            [
                "002a5eb6eb650ca6"
            ]
        ]
    },
    {
        "id": "9e750af3be7b64c8",
        "type": "ui_text",
        "z": "e86e32e3984d7a10",
        "group": "3b7c9cd86fb22b9a",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Open within 24h",
        "format": "{{msg.count}}",
        "layout": "col-center",
        "className": "",
        "x": 980,
        "y": 340,
        "wires": []
    },
    {
        "id": "b6ae998389b4ec71",
        "type": "counter",
        "z": "e86e32e3984d7a10",
        "name": "Open within 24h",
        "init": "0",
        "step": "1",
        "lower": "",
        "upper": "",
        "mode": "increment",
        "outputs": "1",
        "x": 740,
        "y": 340,
        "wires": [
            [
                "9e750af3be7b64c8"
            ]
        ]
    },
    {
        "id": "7f87064e04a65b54",
        "type": "inject",
        "z": "e86e32e3984d7a10",
        "name": "Reset every 24h",
        "props": [
            {
                "p": "reset",
                "v": "0",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "10 00 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 390,
        "y": 360,
        "wires": [
            [
                "b6ae998389b4ec71"
            ]
        ]
    },
    {
        "id": "f495bf6e00b170e7",
        "type": "counter",
        "z": "e86e32e3984d7a10",
        "name": "Open within 48h",
        "init": "0",
        "step": "1",
        "lower": "",
        "upper": "",
        "mode": "increment",
        "outputs": "1",
        "x": 740,
        "y": 400,
        "wires": [
            [
                "05fc55b09c6566bf"
            ]
        ]
    },
    {
        "id": "f7fb07ccdf63870e",
        "type": "counter",
        "z": "e86e32e3984d7a10",
        "name": "Open within 7days",
        "init": "0",
        "step": "1",
        "lower": "",
        "upper": "",
        "mode": "increment",
        "outputs": "1",
        "x": 750,
        "y": 460,
        "wires": [
            [
                "b6b2682b2ce1ef2e"
            ]
        ]
    },
    {
        "id": "05fc55b09c6566bf",
        "type": "ui_text",
        "z": "e86e32e3984d7a10",
        "group": "3b7c9cd86fb22b9a",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Open within 48h",
        "format": "{{msg.count}}",
        "layout": "col-center",
        "className": "",
        "x": 980,
        "y": 400,
        "wires": []
    },
    {
        "id": "b6b2682b2ce1ef2e",
        "type": "ui_text",
        "z": "e86e32e3984d7a10",
        "group": "3b7c9cd86fb22b9a",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Open within 7 days",
        "format": "{{msg.count}}",
        "layout": "col-center",
        "className": "",
        "x": 990,
        "y": 460,
        "wires": []
    },
    {
        "id": "107f08977d91fa97",
        "type": "inject",
        "z": "e86e32e3984d7a10",
        "name": "Reset every 48h",
        "props": [
            {
                "p": "reset",
                "v": "0",
                "vt": "str"
            }
        ],
        "repeat": "172800",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 390,
        "y": 440,
        "wires": [
            [
                "f495bf6e00b170e7"
            ]
        ]
    },
    {
        "id": "395fc4fee333dbad",
        "type": "inject",
        "z": "e86e32e3984d7a10",
        "name": "Reset every 7 days",
        "props": [
            {
                "p": "reset",
                "v": "0",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "45 00 * * 1",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 380,
        "y": 520,
        "wires": [
            [
                "f7fb07ccdf63870e"
            ]
        ]
    },
    {
        "id": "24579bcb.5c9814",
        "type": "inject",
        "z": "e1b8a77c64d29e6e",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 16 * * 1,2,3,4,5",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "payload": "It is 4pm on a weekday!",
        "payloadType": "str",
        "x": 150,
        "y": 60,
        "wires": [
            [
                "145b508a.f3325f"
            ]
        ]
    },
    {
        "id": "145b508a.f3325f",
        "type": "debug",
        "z": "e1b8a77c64d29e6e",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 370,
        "y": 60,
        "wires": []
    },
    {
        "id": "737ec844.a9a218",
        "type": "trigger",
        "z": "e1b8a77c64d29e6e",
        "name": "",
        "op1": "",
        "op2": "1",
        "op1type": "nul",
        "op2type": "num",
        "duration": "5",
        "extend": false,
        "overrideDelay": false,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 420,
        "y": 280,
        "wires": [
            [
                "6ec839c8.f7578"
            ]
        ]
    },
    {
        "id": "a093533.65d163",
        "type": "debug",
        "z": "e1b8a77c64d29e6e",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 730,
        "y": 280,
        "wires": []
    },
    {
        "id": "653bee85.b01298",
        "type": "inject",
        "z": "e1b8a77c64d29e6e",
        "name": "New Unit",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 145,
        "y": 280,
        "wires": [
            [
                "368cd45a.3160a4"
            ]
        ]
    },
    {
        "id": "6ec839c8.f7578",
        "type": "function",
        "z": "e1b8a77c64d29e6e",
        "name": "",
        "func": "const c = msg.payload\nconst f = flow.get(\"counter\")\nconst o = c+f\n\nflow.set(\"counter\",o)\nnode.status({fill:\"green\",shape:\"dot\",text:\"count:\"+o});\nreturn {payload:{counter:o}};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 280,
        "wires": [
            [
                "a093533.65d163",
                "737ec844.a9a218"
            ]
        ]
    },
    {
        "id": "368cd45a.3160a4",
        "type": "function",
        "z": "e1b8a77c64d29e6e",
        "name": "",
        "func": "flow.set(\"counter\",0)\nreturn {payload:{unit:true}};\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 240,
        "wires": [
            [
                "737ec844.a9a218"
            ]
        ]
    },
    {
        "id": "bec935a3.98b75",
        "type": "inject",
        "z": "e1b8a77c64d29e6e",
        "name": "decrement",
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 520,
        "wires": [
            [
                "bc1de050.491f98"
            ]
        ]
    },
    {
        "id": "8d22dd31.8495f",
        "type": "inject",
        "z": "e1b8a77c64d29e6e",
        "name": "increment",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 480,
        "wires": [
            [
                "5e368c1.8e22f74"
            ]
        ]
    },
    {
        "id": "dc3ba493.e19b8",
        "type": "inject",
        "z": "e1b8a77c64d29e6e",
        "name": "reset",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 560,
        "wires": [
            [
                "e070ec23.46e298"
            ]
        ]
    },
    {
        "id": "5e368c1.8e22f74",
        "type": "function",
        "z": "e1b8a77c64d29e6e",
        "name": "msg object",
        "func": "msg.increment = 0.0614;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 480,
        "wires": [
            [
                "ec0aac11.59f39"
            ]
        ]
    },
    {
        "id": "e070ec23.46e298",
        "type": "function",
        "z": "e1b8a77c64d29e6e",
        "name": "msg object",
        "func": "msg.reset=\"0\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 560,
        "wires": [
            [
                "ec0aac11.59f39"
            ]
        ]
    },
    {
        "id": "bc1de050.491f98",
        "type": "function",
        "z": "e1b8a77c64d29e6e",
        "name": "msg object",
        "func": "msg.decrement = 0.0614;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 520,
        "wires": [
            [
                "ec0aac11.59f39"
            ]
        ]
    },
    {
        "id": "ec0aac11.59f39",
        "type": "counter",
        "z": "e1b8a77c64d29e6e",
        "name": "",
        "init": "0",
        "step": "1",
        "lower": null,
        "upper": null,
        "mode": "increment",
        "outputs": 2,
        "x": 620,
        "y": 500,
        "wires": [
            [
                "a60bc61807f404f0"
            ],
            []
        ]
    },
    {
        "id": "5f32e0acea573790",
        "type": "mqtt in",
        "z": "e1b8a77c64d29e6e",
        "name": "",
        "topic": "zigbee2mqtt/PIR_Aqara_01",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 140,
        "y": 720,
        "wires": [
            [
                "7a8668b292658617",
                "67bf8392d8098db1"
            ]
        ]
    },
    {
        "id": "b4ebfb1c2ac05cb5",
        "type": "inject",
        "z": "e1b8a77c64d29e6e",
        "name": "28*C",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"device_temperature\":28,\"illuminance\":47,\"illuminance_lux\":47,\"linkquality\":48,\"occupancy\":false,\"power_outage_count\":7,\"voltage\":3015}",
        "payloadType": "json",
        "x": 90,
        "y": 820,
        "wires": [
            [
                "67bf8392d8098db1"
            ]
        ]
    },
    {
        "id": "442c244f291a0704",
        "type": "file",
        "z": "e1b8a77c64d29e6e",
        "d": true,
        "name": "",
        "filename": "/share/aqara-temp.log",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 800,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "7a8668b292658617",
        "type": "function",
        "z": "e1b8a77c64d29e6e",
        "d": true,
        "name": "Add timestamp to payload",
        "func": "const datetime = new Date().toLocaleString();\nmsg.payload = `[${datetime}] ${msg.payload.device_temperature}`;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 720,
        "wires": [
            [
                "442c244f291a0704"
            ]
        ]
    },
    {
        "id": "67bf8392d8098db1",
        "type": "switch",
        "z": "e1b8a77c64d29e6e",
        "name": "is cold?",
        "property": "payload.device_temperature",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lt",
                "v": "19",
                "vt": "str"
            },
            {
                "t": "gt",
                "v": "23",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 400,
        "y": 860,
        "wires": [
            [
                "438387969436762f",
                "a8e8bd0162651e63"
            ],
            [
                "84fd2b5476acf986"
            ]
        ]
    },
    {
        "id": "d2d130683e866e62",
        "type": "debug",
        "z": "e1b8a77c64d29e6e",
        "name": "debug Heat On",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 780,
        "wires": []
    },
    {
        "id": "84fd2b5476acf986",
        "type": "debug",
        "z": "e1b8a77c64d29e6e",
        "name": "debug Heat Off",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 880,
        "wires": []
    },
    {
        "id": "438387969436762f",
        "type": "countdown",
        "z": "e1b8a77c64d29e6e",
        "name": "",
        "topic": "",
        "payloadTimerStart": "true",
        "payloadTimerStartType": "bool",
        "payloadTimerStop": "false",
        "payloadTimerStopType": "bool",
        "timer": "7",
        "resetWhileRunning": true,
        "outputOnReset": false,
        "setTimeToNewWhileRunning": true,
        "startCountdownOnControlMessage": true,
        "x": 650,
        "y": 820,
        "wires": [
            [
                "c2322e4ce8b0f6f8"
            ],
            []
        ]
    },
    {
        "id": "c2322e4ce8b0f6f8",
        "type": "switch",
        "z": "e1b8a77c64d29e6e",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 830,
        "y": 800,
        "wires": [
            [
                "d2d130683e866e62"
            ],
            [
                "84fd2b5476acf986"
            ]
        ]
    },
    {
        "id": "9793a2c9cc635d39",
        "type": "inject",
        "z": "e1b8a77c64d29e6e",
        "name": "18*C",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"device_temperature\":18,\"illuminance\":47,\"illuminance_lux\":47,\"linkquality\":48,\"occupancy\":false,\"power_outage_count\":7,\"voltage\":3015}",
        "payloadType": "json",
        "x": 90,
        "y": 900,
        "wires": [
            [
                "67bf8392d8098db1"
            ]
        ]
    },
    {
        "id": "a8e8bd0162651e63",
        "type": "debug",
        "z": "e1b8a77c64d29e6e",
        "name": "debug 76",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 500,
        "y": 780,
        "wires": []
    },
    {
        "id": "a60bc61807f404f0",
        "type": "debug",
        "z": "e1b8a77c64d29e6e",
        "name": "debug 78",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 820,
        "y": 500,
        "wires": []
    },
    {
        "id": "37e037257fcecd5d",
        "type": "mqtt in",
        "z": "78ddf6bd666829fb",
        "name": "",
        "topic": "zigbee2mqtt/PIR_SNZB-03_04",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 173,
        "y": 180,
        "wires": [
            [
                "ad3f6f0adfb6df19"
            ]
        ]
    },
    {
        "id": "ad3f6f0adfb6df19",
        "type": "subflow:ce92b488da80a9bb",
        "z": "78ddf6bd666829fb",
        "name": "",
        "env": [
            {
                "name": "TIMEOUT",
                "value": "30",
                "type": "num"
            },
            {
                "name": "NIGHT_BRIGHTNESS",
                "value": "170",
                "type": "num"
            },
            {
                "name": "NIGHT_TIME",
                "value": "21:30",
                "type": "str"
            },
            {
                "name": "NIGHT_TIMEOUT",
                "value": "30",
                "type": "num"
            }
        ],
        "x": 810,
        "y": 180,
        "wires": [
            [
                "d8d53e352aa1c427",
                "e7d525f8ad427bff",
                "83e1ae570ac125b4"
            ],
            [
                "f05f6af054b659b9"
            ]
        ]
    },
    {
        "id": "683d484c95cc9a47",
        "type": "change",
        "z": "78ddf6bd666829fb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Ground Floor Light is ON",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "300",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1260,
        "y": 160,
        "wires": [
            [
                "3b9eb647946086cb"
            ]
        ]
    },
    {
        "id": "f05f6af054b659b9",
        "type": "change",
        "z": "78ddf6bd666829fb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Ground Floor Light is ON",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1200,
        "y": 260,
        "wires": [
            [
                "3b9eb647946086cb"
            ]
        ]
    },
    {
        "id": "e7d525f8ad427bff",
        "type": "switch",
        "z": "78ddf6bd666829fb",
        "name": "",
        "property": "payload.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ON",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 180,
        "wires": [
            [
                "683d484c95cc9a47"
            ],
            [
                "f0b28ff7eeed1a14"
            ]
        ]
    },
    {
        "id": "f0b28ff7eeed1a14",
        "type": "change",
        "z": "78ddf6bd666829fb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Ground Floor Light is OFF",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1260,
        "y": 200,
        "wires": [
            [
                "3b9eb647946086cb"
            ]
        ]
    },
    {
        "id": "3b9eb647946086cb",
        "type": "ui_gauge",
        "z": "78ddf6bd666829fb",
        "name": "",
        "group": "3b825d13cf529239",
        "order": 10,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "{{msg.topic}}",
        "label": "Seconds",
        "format": "{{value}}",
        "min": 0,
        "max": "300",
        "colors": [
            "#faf700",
            "#fff700",
            "#fff600"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1570,
        "y": 220,
        "wires": []
    },
    {
        "id": "d8d53e352aa1c427",
        "type": "mqtt out",
        "z": "78ddf6bd666829fb",
        "name": "ground floor bulb door bulb",
        "topic": "zigbee2mqtt/Bulb_Linkind_02/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1100,
        "y": 40,
        "wires": []
    },
    {
        "id": "ebfd3a1c1a34eb27",
        "type": "inject",
        "z": "78ddf6bd666829fb",
        "name": "occupancy true",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":true,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 220,
        "y": 60,
        "wires": [
            [
                "ad3f6f0adfb6df19"
            ]
        ]
    },
    {
        "id": "0f5535971f1fdf3d",
        "type": "inject",
        "z": "78ddf6bd666829fb",
        "name": "occupancy false",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"linkquality\":72,\"occupancy\":false,\"tamper\":false,\"voltage\":3000}",
        "payloadType": "json",
        "x": 220,
        "y": 120,
        "wires": [
            [
                "ad3f6f0adfb6df19"
            ]
        ]
    },
    {
        "id": "4947461fde925c71",
        "type": "mqtt in",
        "z": "78ddf6bd666829fb",
        "name": "",
        "topic": "zigbee2mqtt/door",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "3ea2a9db3d9d7fd8",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 240,
        "wires": [
            [
                "734efdc623683809"
            ]
        ]
    },
    {
        "id": "12f5ce3f75df2df1",
        "type": "inject",
        "z": "78ddf6bd666829fb",
        "name": "Closed",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"contact\":true,\"linkquality\":63,\"tamper\":false,\"voltage\":3100}",
        "payloadType": "json",
        "x": 250,
        "y": 320,
        "wires": [
            [
                "e735c6c6661f61fd"
            ]
        ]
    },
    {
        "id": "e735c6c6661f61fd",
        "type": "change",
        "z": "78ddf6bd666829fb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.occupancy",
                "pt": "msg",
                "to": "$not(payload.contact)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 240,
        "wires": [
            [
                "ad3f6f0adfb6df19"
            ]
        ]
    },
    {
        "id": "6b57984b53649c36",
        "type": "inject",
        "z": "78ddf6bd666829fb",
        "name": "Opened",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"battery\":100,\"battery_low\":false,\"contact\":true,\"linkquality\":63,\"tamper\":false,\"voltage\":3100}",
        "payloadType": "json",
        "x": 250,
        "y": 380,
        "wires": [
            [
                "e735c6c6661f61fd"
            ]
        ]
    },
    {
        "id": "83e1ae570ac125b4",
        "type": "mqtt out",
        "z": "78ddf6bd666829fb",
        "name": "ground floor bulb stairs bulb",
        "topic": "zigbee2mqtt/Bulb_Ikea_01/set",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "3ea2a9db3d9d7fd8",
        "x": 1100,
        "y": 100,
        "wires": []
    },
    {
        "id": "734efdc623683809",
        "type": "switch",
        "z": "78ddf6bd666829fb",
        "name": "",
        "property": "payload.contact",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 310,
        "y": 240,
        "wires": [
            [
                "e735c6c6661f61fd"
            ]
        ]
    }
]